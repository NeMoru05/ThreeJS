{
  "version": 3,
  "sources": ["../../three/examples/jsm/controls/ArcballControls.js"],
  "sourcesContent": ["import {\r\n\tGridHelper,\r\n\tEllipseCurve,\r\n\tBufferGeometry,\r\n\tLine,\r\n\tLineBasicMaterial,\r\n\tRaycaster,\r\n\tGroup,\r\n\tBox3,\r\n\tSphere,\r\n\tQuaternion,\r\n\tVector2,\r\n\tVector3,\r\n\tMatrix4,\r\n\tMathUtils,\r\n\tEventDispatcher\r\n} from 'three';\r\n\r\n//trackball state\r\nconst STATE = {\r\n\r\n\tIDLE: Symbol(),\r\n\tROTATE: Symbol(),\r\n\tPAN: Symbol(),\r\n\tSCALE: Symbol(),\r\n\tFOV: Symbol(),\r\n\tFOCUS: Symbol(),\r\n\tZROTATE: Symbol(),\r\n\tTOUCH_MULTI: Symbol(),\r\n\tANIMATION_FOCUS: Symbol(),\r\n\tANIMATION_ROTATE: Symbol()\r\n\r\n};\r\n\r\nconst INPUT = {\r\n\r\n\tNONE: Symbol(),\r\n\tONE_FINGER: Symbol(),\r\n\tONE_FINGER_SWITCHED: Symbol(),\r\n\tTWO_FINGER: Symbol(),\r\n\tMULT_FINGER: Symbol(),\r\n\tCURSOR: Symbol()\r\n\r\n};\r\n\r\n//cursor center coordinates\r\nconst _center = {\r\n\r\n\tx: 0,\r\n\ty: 0\r\n\r\n};\r\n\r\n//transformation matrices for gizmos and camera\r\nconst _transformation = {\r\n\r\n\tcamera: new Matrix4(),\r\n\tgizmos: new Matrix4()\r\n\r\n};\r\n\r\n//events\r\nconst _changeEvent = { type: 'change' };\r\nconst _startEvent = { type: 'start' };\r\nconst _endEvent = { type: 'end' };\r\n\r\nconst _raycaster = new Raycaster();\r\nconst _offset = new Vector3();\r\n\r\nconst _gizmoMatrixStateTemp = new Matrix4();\r\nconst _cameraMatrixStateTemp = new Matrix4();\r\nconst _scalePointTemp = new Vector3();\r\n/**\r\n *\r\n * @param {Camera} camera Virtual camera used in the scene\r\n * @param {HTMLElement} domElement Renderer's dom element\r\n * @param {Scene} scene The scene to be rendered\r\n */\r\nclass ArcballControls extends EventDispatcher {\r\n\r\n\tconstructor( camera, domElement, scene = null ) {\r\n\r\n\t\tsuper();\r\n\t\tthis.camera = null;\r\n\t\tthis.domElement = domElement;\r\n\t\tthis.scene = scene;\r\n\t\tthis.target = new Vector3();\r\n\t\tthis._currentTarget = new Vector3();\r\n\t\tthis.radiusFactor = 0.67;\r\n\r\n\t\tthis.mouseActions = [];\r\n\t\tthis._mouseOp = null;\r\n\r\n\r\n\t\t//global vectors and matrices that are used in some operations to avoid creating new objects every time (e.g. every time cursor moves)\r\n\t\tthis._v2_1 = new Vector2();\r\n\t\tthis._v3_1 = new Vector3();\r\n\t\tthis._v3_2 = new Vector3();\r\n\r\n\t\tthis._m4_1 = new Matrix4();\r\n\t\tthis._m4_2 = new Matrix4();\r\n\r\n\t\tthis._quat = new Quaternion();\r\n\r\n\t\t//transformation matrices\r\n\t\tthis._translationMatrix = new Matrix4(); //matrix for translation operation\r\n\t\tthis._rotationMatrix = new Matrix4(); //matrix for rotation operation\r\n\t\tthis._scaleMatrix = new Matrix4(); //matrix for scaling operation\r\n\r\n\t\tthis._rotationAxis = new Vector3(); //axis for rotate operation\r\n\r\n\r\n\t\t//camera state\r\n\t\tthis._cameraMatrixState = new Matrix4();\r\n\t\tthis._cameraProjectionState = new Matrix4();\r\n\r\n\t\tthis._fovState = 1;\r\n\t\tthis._upState = new Vector3();\r\n\t\tthis._zoomState = 1;\r\n\t\tthis._nearPos = 0;\r\n\t\tthis._farPos = 0;\r\n\r\n\t\tthis._gizmoMatrixState = new Matrix4();\r\n\r\n\t\t//initial values\r\n\t\tthis._up0 = new Vector3();\r\n\t\tthis._zoom0 = 1;\r\n\t\tthis._fov0 = 0;\r\n\t\tthis._initialNear = 0;\r\n\t\tthis._nearPos0 = 0;\r\n\t\tthis._initialFar = 0;\r\n\t\tthis._farPos0 = 0;\r\n\t\tthis._cameraMatrixState0 = new Matrix4();\r\n\t\tthis._gizmoMatrixState0 = new Matrix4();\r\n\r\n\t\t//pointers array\r\n\t\tthis._button = - 1;\r\n\t\tthis._touchStart = [];\r\n\t\tthis._touchCurrent = [];\r\n\t\tthis._input = INPUT.NONE;\r\n\r\n\t\t//two fingers touch interaction\r\n\t\tthis._switchSensibility = 32;\t//minimum movement to be performed to fire single pan start after the second finger has been released\r\n\t\tthis._startFingerDistance = 0; //distance between two fingers\r\n\t\tthis._currentFingerDistance = 0;\r\n\t\tthis._startFingerRotation = 0; //amount of rotation performed with two fingers\r\n\t\tthis._currentFingerRotation = 0;\r\n\r\n\t\t//double tap\r\n\t\tthis._devPxRatio = 0;\r\n\t\tthis._downValid = true;\r\n\t\tthis._nclicks = 0;\r\n\t\tthis._downEvents = [];\r\n\t\tthis._downStart = 0;\t//pointerDown time\r\n\t\tthis._clickStart = 0;\t//first click time\r\n\t\tthis._maxDownTime = 250;\r\n\t\tthis._maxInterval = 300;\r\n\t\tthis._posThreshold = 24;\r\n\t\tthis._movementThreshold = 24;\r\n\r\n\t\t//cursor positions\r\n\t\tthis._currentCursorPosition = new Vector3();\r\n\t\tthis._startCursorPosition = new Vector3();\r\n\r\n\t\t//grid\r\n\t\tthis._grid = null; //grid to be visualized during pan operation\r\n\t\tthis._gridPosition = new Vector3();\r\n\r\n\t\t//gizmos\r\n\t\tthis._gizmos = new Group();\r\n\t\tthis._curvePts = 128;\r\n\r\n\r\n\t\t//animations\r\n\t\tthis._timeStart = - 1; //initial time\r\n\t\tthis._animationId = - 1;\r\n\r\n\t\t//focus animation\r\n\t\tthis.focusAnimationTime = 500; //duration of focus animation in ms\r\n\r\n\t\t//rotate animation\r\n\t\tthis._timePrev = 0; //time at which previous rotate operation has been detected\r\n\t\tthis._timeCurrent = 0; //time at which current rotate operation has been detected\r\n\t\tthis._anglePrev = 0; //angle of previous rotation\r\n\t\tthis._angleCurrent = 0; //angle of current rotation\r\n\t\tthis._cursorPosPrev = new Vector3();\t//cursor position when previous rotate operation has been detected\r\n\t\tthis._cursorPosCurr = new Vector3();//cursor position when current rotate operation has been detected\r\n\t\tthis._wPrev = 0; //angular velocity of the previous rotate operation\r\n\t\tthis._wCurr = 0; //angular velocity of the current rotate operation\r\n\r\n\r\n\t\t//parameters\r\n\t\tthis.adjustNearFar = false;\r\n\t\tthis.scaleFactor = 1.1;\t//zoom/distance multiplier\r\n\t\tthis.dampingFactor = 25;\r\n\t\tthis.wMax = 20;\t//maximum angular velocity allowed\r\n\t\tthis.enableAnimations = true; //if animations should be performed\r\n\t\tthis.enableGrid = false; //if grid should be showed during pan operation\r\n\t\tthis.cursorZoom = false;\t//if wheel zoom should be cursor centered\r\n\t\tthis.minFov = 5;\r\n\t\tthis.maxFov = 90;\r\n\t\tthis.rotateSpeed = 1;\r\n\r\n\t\tthis.enabled = true;\r\n\t\tthis.enablePan = true;\r\n\t\tthis.enableRotate = true;\r\n\t\tthis.enableZoom = true;\r\n\t\tthis.enableGizmos = true;\r\n\r\n\t\tthis.minDistance = 0;\r\n\t\tthis.maxDistance = Infinity;\r\n\t\tthis.minZoom = 0;\r\n\t\tthis.maxZoom = Infinity;\r\n\r\n\t\t//trackball parameters\r\n\t\tthis._tbRadius = 1;\r\n\r\n\t\t//FSA\r\n\t\tthis._state = STATE.IDLE;\r\n\r\n\t\tthis.setCamera( camera );\r\n\r\n\t\tif ( this.scene != null ) {\r\n\r\n\t\t\tthis.scene.add( this._gizmos );\r\n\r\n\t\t}\r\n\r\n\t\tthis.domElement.style.touchAction = 'none';\r\n\t\tthis._devPxRatio = window.devicePixelRatio;\r\n\r\n\t\tthis.initializeMouseActions();\r\n\r\n\t\tthis._onContextMenu = onContextMenu.bind( this );\r\n\t\tthis._onWheel = onWheel.bind( this );\r\n\t\tthis._onPointerUp = onPointerUp.bind( this );\r\n\t\tthis._onPointerMove = onPointerMove.bind( this );\r\n\t\tthis._onPointerDown = onPointerDown.bind( this );\r\n\t\tthis._onPointerCancel = onPointerCancel.bind( this );\r\n\t\tthis._onWindowResize = onWindowResize.bind( this );\r\n\r\n\t\tthis.domElement.addEventListener( 'contextmenu', this._onContextMenu );\r\n\t\tthis.domElement.addEventListener( 'wheel', this._onWheel );\r\n\t\tthis.domElement.addEventListener( 'pointerdown', this._onPointerDown );\r\n\t\tthis.domElement.addEventListener( 'pointercancel', this._onPointerCancel );\r\n\r\n\t\twindow.addEventListener( 'resize', this._onWindowResize );\r\n\r\n\t}\r\n\r\n\tonSinglePanStart( event, operation ) {\r\n\r\n\t\tif ( this.enabled ) {\r\n\r\n\t\t\tthis.dispatchEvent( _startEvent );\r\n\r\n\t\t\tthis.setCenter( event.clientX, event.clientY );\r\n\r\n\t\t\tswitch ( operation ) {\r\n\r\n\t\t\t\tcase 'PAN':\r\n\r\n\t\t\t\t\tif ( ! this.enablePan ) {\r\n\r\n\t\t\t\t\t\treturn;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif ( this._animationId != - 1 ) {\r\n\r\n\t\t\t\t\t\tcancelAnimationFrame( this._animationId );\r\n\t\t\t\t\t\tthis._animationId = - 1;\r\n\t\t\t\t\t\tthis._timeStart = - 1;\r\n\r\n\t\t\t\t\t\tthis.activateGizmos( false );\r\n\t\t\t\t\t\tthis.dispatchEvent( _changeEvent );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tthis.updateTbState( STATE.PAN, true );\r\n\t\t\t\t\tthis._startCursorPosition.copy( this.unprojectOnTbPlane( this.camera, _center.x, _center.y, this.domElement ) );\r\n\t\t\t\t\tif ( this.enableGrid ) {\r\n\r\n\t\t\t\t\t\tthis.drawGrid();\r\n\t\t\t\t\t\tthis.dispatchEvent( _changeEvent );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'ROTATE':\r\n\r\n\t\t\t\t\tif ( ! this.enableRotate ) {\r\n\r\n\t\t\t\t\t\treturn;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif ( this._animationId != - 1 ) {\r\n\r\n\t\t\t\t\t\tcancelAnimationFrame( this._animationId );\r\n\t\t\t\t\t\tthis._animationId = - 1;\r\n\t\t\t\t\t\tthis._timeStart = - 1;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tthis.updateTbState( STATE.ROTATE, true );\r\n\t\t\t\t\tthis._startCursorPosition.copy( this.unprojectOnTbSurface( this.camera, _center.x, _center.y, this.domElement, this._tbRadius ) );\r\n\t\t\t\t\tthis.activateGizmos( true );\r\n\t\t\t\t\tif ( this.enableAnimations ) {\r\n\r\n\t\t\t\t\t\tthis._timePrev = this._timeCurrent = performance.now();\r\n\t\t\t\t\t\tthis._angleCurrent = this._anglePrev = 0;\r\n\t\t\t\t\t\tthis._cursorPosPrev.copy( this._startCursorPosition );\r\n\t\t\t\t\t\tthis._cursorPosCurr.copy( this._cursorPosPrev );\r\n\t\t\t\t\t\tthis._wCurr = 0;\r\n\t\t\t\t\t\tthis._wPrev = this._wCurr;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tthis.dispatchEvent( _changeEvent );\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'FOV':\r\n\r\n\t\t\t\t\tif ( ! this.camera.isPerspectiveCamera || ! this.enableZoom ) {\r\n\r\n\t\t\t\t\t\treturn;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif ( this._animationId != - 1 ) {\r\n\r\n\t\t\t\t\t\tcancelAnimationFrame( this._animationId );\r\n\t\t\t\t\t\tthis._animationId = - 1;\r\n\t\t\t\t\t\tthis._timeStart = - 1;\r\n\r\n\t\t\t\t\t\tthis.activateGizmos( false );\r\n\t\t\t\t\t\tthis.dispatchEvent( _changeEvent );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tthis.updateTbState( STATE.FOV, true );\r\n\t\t\t\t\tthis._startCursorPosition.setY( this.getCursorNDC( _center.x, _center.y, this.domElement ).y * 0.5 );\r\n\t\t\t\t\tthis._currentCursorPosition.copy( this._startCursorPosition );\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'ZOOM':\r\n\r\n\t\t\t\t\tif ( ! this.enableZoom ) {\r\n\r\n\t\t\t\t\t\treturn;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif ( this._animationId != - 1 ) {\r\n\r\n\t\t\t\t\t\tcancelAnimationFrame( this._animationId );\r\n\t\t\t\t\t\tthis._animationId = - 1;\r\n\t\t\t\t\t\tthis._timeStart = - 1;\r\n\r\n\t\t\t\t\t\tthis.activateGizmos( false );\r\n\t\t\t\t\t\tthis.dispatchEvent( _changeEvent );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tthis.updateTbState( STATE.SCALE, true );\r\n\t\t\t\t\tthis._startCursorPosition.setY( this.getCursorNDC( _center.x, _center.y, this.domElement ).y * 0.5 );\r\n\t\t\t\t\tthis._currentCursorPosition.copy( this._startCursorPosition );\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tonSinglePanMove( event, opState ) {\r\n\r\n\t\tif ( this.enabled ) {\r\n\r\n\t\t\tconst restart = opState != this._state;\r\n\t\t\tthis.setCenter( event.clientX, event.clientY );\r\n\r\n\t\t\tswitch ( opState ) {\r\n\r\n\t\t\t\tcase STATE.PAN:\r\n\r\n\t\t\t\t\tif ( this.enablePan ) {\r\n\r\n\t\t\t\t\t\tif ( restart ) {\r\n\r\n\t\t\t\t\t\t\t//switch to pan operation\r\n\r\n\t\t\t\t\t\t\tthis.dispatchEvent( _endEvent );\r\n\t\t\t\t\t\t\tthis.dispatchEvent( _startEvent );\r\n\r\n\t\t\t\t\t\t\tthis.updateTbState( opState, true );\r\n\t\t\t\t\t\t\tthis._startCursorPosition.copy( this.unprojectOnTbPlane( this.camera, _center.x, _center.y, this.domElement ) );\r\n\t\t\t\t\t\t\tif ( this.enableGrid ) {\r\n\r\n\t\t\t\t\t\t\t\tthis.drawGrid();\r\n\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tthis.activateGizmos( false );\r\n\r\n\t\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\t\t//continue with pan operation\r\n\t\t\t\t\t\t\tthis._currentCursorPosition.copy( this.unprojectOnTbPlane( this.camera, _center.x, _center.y, this.domElement ) );\r\n\t\t\t\t\t\t\tthis.applyTransformMatrix( this.pan( this._startCursorPosition, this._currentCursorPosition ) );\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase STATE.ROTATE:\r\n\r\n\t\t\t\t\tif ( this.enableRotate ) {\r\n\r\n\t\t\t\t\t\tif ( restart ) {\r\n\r\n\t\t\t\t\t\t\t//switch to rotate operation\r\n\r\n\t\t\t\t\t\t\tthis.dispatchEvent( _endEvent );\r\n\t\t\t\t\t\t\tthis.dispatchEvent( _startEvent );\r\n\r\n\t\t\t\t\t\t\tthis.updateTbState( opState, true );\r\n\t\t\t\t\t\t\tthis._startCursorPosition.copy( this.unprojectOnTbSurface( this.camera, _center.x, _center.y, this.domElement, this._tbRadius ) );\r\n\r\n\t\t\t\t\t\t\tif ( this.enableGrid ) {\r\n\r\n\t\t\t\t\t\t\t\tthis.disposeGrid();\r\n\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tthis.activateGizmos( true );\r\n\r\n\t\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\t\t//continue with rotate operation\r\n\t\t\t\t\t\t\tthis._currentCursorPosition.copy( this.unprojectOnTbSurface( this.camera, _center.x, _center.y, this.domElement, this._tbRadius ) );\r\n\r\n\t\t\t\t\t\t\tconst distance = this._startCursorPosition.distanceTo( this._currentCursorPosition );\r\n\t\t\t\t\t\t\tconst angle = this._startCursorPosition.angleTo( this._currentCursorPosition );\r\n\t\t\t\t\t\t\tconst amount = Math.max( distance / this._tbRadius, angle ) * this.rotateSpeed; //effective rotation angle\r\n\r\n\t\t\t\t\t\t\tthis.applyTransformMatrix( this.rotate( this.calculateRotationAxis( this._startCursorPosition, this._currentCursorPosition ), amount ) );\r\n\r\n\t\t\t\t\t\t\tif ( this.enableAnimations ) {\r\n\r\n\t\t\t\t\t\t\t\tthis._timePrev = this._timeCurrent;\r\n\t\t\t\t\t\t\t\tthis._timeCurrent = performance.now();\r\n\t\t\t\t\t\t\t\tthis._anglePrev = this._angleCurrent;\r\n\t\t\t\t\t\t\t\tthis._angleCurrent = amount;\r\n\t\t\t\t\t\t\t\tthis._cursorPosPrev.copy( this._cursorPosCurr );\r\n\t\t\t\t\t\t\t\tthis._cursorPosCurr.copy( this._currentCursorPosition );\r\n\t\t\t\t\t\t\t\tthis._wPrev = this._wCurr;\r\n\t\t\t\t\t\t\t\tthis._wCurr = this.calculateAngularSpeed( this._anglePrev, this._angleCurrent, this._timePrev, this._timeCurrent );\r\n\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase STATE.SCALE:\r\n\r\n\t\t\t\t\tif ( this.enableZoom ) {\r\n\r\n\t\t\t\t\t\tif ( restart ) {\r\n\r\n\t\t\t\t\t\t\t//switch to zoom operation\r\n\r\n\t\t\t\t\t\t\tthis.dispatchEvent( _endEvent );\r\n\t\t\t\t\t\t\tthis.dispatchEvent( _startEvent );\r\n\r\n\t\t\t\t\t\t\tthis.updateTbState( opState, true );\r\n\t\t\t\t\t\t\tthis._startCursorPosition.setY( this.getCursorNDC( _center.x, _center.y, this.domElement ).y * 0.5 );\r\n\t\t\t\t\t\t\tthis._currentCursorPosition.copy( this._startCursorPosition );\r\n\r\n\t\t\t\t\t\t\tif ( this.enableGrid ) {\r\n\r\n\t\t\t\t\t\t\t\tthis.disposeGrid();\r\n\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tthis.activateGizmos( false );\r\n\r\n\t\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\t\t//continue with zoom operation\r\n\t\t\t\t\t\t\tconst screenNotches = 8;\t//how many wheel notches corresponds to a full screen pan\r\n\t\t\t\t\t\t\tthis._currentCursorPosition.setY( this.getCursorNDC( _center.x, _center.y, this.domElement ).y * 0.5 );\r\n\r\n\t\t\t\t\t\t\tconst movement = this._currentCursorPosition.y - this._startCursorPosition.y;\r\n\r\n\t\t\t\t\t\t\tlet size = 1;\r\n\r\n\t\t\t\t\t\t\tif ( movement < 0 ) {\r\n\r\n\t\t\t\t\t\t\t\tsize = 1 / ( Math.pow( this.scaleFactor, - movement * screenNotches ) );\r\n\r\n\t\t\t\t\t\t\t} else if ( movement > 0 ) {\r\n\r\n\t\t\t\t\t\t\t\tsize = Math.pow( this.scaleFactor, movement * screenNotches );\r\n\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tthis._v3_1.setFromMatrixPosition( this._gizmoMatrixState );\r\n\r\n\t\t\t\t\t\t\tthis.applyTransformMatrix( this.scale( size, this._v3_1 ) );\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase STATE.FOV:\r\n\r\n\t\t\t\t\tif ( this.enableZoom && this.camera.isPerspectiveCamera ) {\r\n\r\n\t\t\t\t\t\tif ( restart ) {\r\n\r\n\t\t\t\t\t\t\t//switch to fov operation\r\n\r\n\t\t\t\t\t\t\tthis.dispatchEvent( _endEvent );\r\n\t\t\t\t\t\t\tthis.dispatchEvent( _startEvent );\r\n\r\n\t\t\t\t\t\t\tthis.updateTbState( opState, true );\r\n\t\t\t\t\t\t\tthis._startCursorPosition.setY( this.getCursorNDC( _center.x, _center.y, this.domElement ).y * 0.5 );\r\n\t\t\t\t\t\t\tthis._currentCursorPosition.copy( this._startCursorPosition );\r\n\r\n\t\t\t\t\t\t\tif ( this.enableGrid ) {\r\n\r\n\t\t\t\t\t\t\t\tthis.disposeGrid();\r\n\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tthis.activateGizmos( false );\r\n\r\n\t\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\t\t//continue with fov operation\r\n\t\t\t\t\t\t\tconst screenNotches = 8;\t//how many wheel notches corresponds to a full screen pan\r\n\t\t\t\t\t\t\tthis._currentCursorPosition.setY( this.getCursorNDC( _center.x, _center.y, this.domElement ).y * 0.5 );\r\n\r\n\t\t\t\t\t\t\tconst movement = this._currentCursorPosition.y - this._startCursorPosition.y;\r\n\r\n\t\t\t\t\t\t\tlet size = 1;\r\n\r\n\t\t\t\t\t\t\tif ( movement < 0 ) {\r\n\r\n\t\t\t\t\t\t\t\tsize = 1 / ( Math.pow( this.scaleFactor, - movement * screenNotches ) );\r\n\r\n\t\t\t\t\t\t\t} else if ( movement > 0 ) {\r\n\r\n\t\t\t\t\t\t\t\tsize = Math.pow( this.scaleFactor, movement * screenNotches );\r\n\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tthis._v3_1.setFromMatrixPosition( this._cameraMatrixState );\r\n\t\t\t\t\t\t\tconst x = this._v3_1.distanceTo( this._gizmos.position );\r\n\t\t\t\t\t\t\tlet xNew = x / size; //distance between camera and gizmos if scale(size, scalepoint) would be performed\r\n\r\n\t\t\t\t\t\t\t//check min and max distance\r\n\t\t\t\t\t\t\txNew = MathUtils.clamp( xNew, this.minDistance, this.maxDistance );\r\n\r\n\t\t\t\t\t\t\tconst y = x * Math.tan( MathUtils.DEG2RAD * this._fovState * 0.5 );\r\n\r\n\t\t\t\t\t\t\t//calculate new fov\r\n\t\t\t\t\t\t\tlet newFov = MathUtils.RAD2DEG * ( Math.atan( y / xNew ) * 2 );\r\n\r\n\t\t\t\t\t\t\t//check min and max fov\r\n\t\t\t\t\t\t\tnewFov = MathUtils.clamp( newFov, this.minFov, this.maxFov );\r\n\r\n\t\t\t\t\t\t\tconst newDistance = y / Math.tan( MathUtils.DEG2RAD * ( newFov / 2 ) );\r\n\t\t\t\t\t\t\tsize = x / newDistance;\r\n\t\t\t\t\t\t\tthis._v3_2.setFromMatrixPosition( this._gizmoMatrixState );\r\n\r\n\t\t\t\t\t\t\tthis.setFov( newFov );\r\n\t\t\t\t\t\t\tthis.applyTransformMatrix( this.scale( size, this._v3_2, false ) );\r\n\r\n\t\t\t\t\t\t\t//adjusting distance\r\n\t\t\t\t\t\t\t_offset.copy( this._gizmos.position ).sub( this.camera.position ).normalize().multiplyScalar( newDistance / x );\r\n\t\t\t\t\t\t\tthis._m4_1.makeTranslation( _offset.x, _offset.y, _offset.z );\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tthis.dispatchEvent( _changeEvent );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tonSinglePanEnd() {\r\n\r\n\t\tif ( this._state == STATE.ROTATE ) {\r\n\r\n\r\n\t\t\tif ( ! this.enableRotate ) {\r\n\r\n\t\t\t\treturn;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( this.enableAnimations ) {\r\n\r\n\t\t\t\t//perform rotation animation\r\n\t\t\t\tconst deltaTime = ( performance.now() - this._timeCurrent );\r\n\t\t\t\tif ( deltaTime < 120 ) {\r\n\r\n\t\t\t\t\tconst w = Math.abs( ( this._wPrev + this._wCurr ) / 2 );\r\n\r\n\t\t\t\t\tconst self = this;\r\n\t\t\t\t\tthis._animationId = window.requestAnimationFrame( function ( t ) {\r\n\r\n\t\t\t\t\t\tself.updateTbState( STATE.ANIMATION_ROTATE, true );\r\n\t\t\t\t\t\tconst rotationAxis = self.calculateRotationAxis( self._cursorPosPrev, self._cursorPosCurr );\r\n\r\n\t\t\t\t\t\tself.onRotationAnim( t, rotationAxis, Math.min( w, self.wMax ) );\r\n\r\n\t\t\t\t\t} );\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\t//cursor has been standing still for over 120 ms since last movement\r\n\t\t\t\t\tthis.updateTbState( STATE.IDLE, false );\r\n\t\t\t\t\tthis.activateGizmos( false );\r\n\t\t\t\t\tthis.dispatchEvent( _changeEvent );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tthis.updateTbState( STATE.IDLE, false );\r\n\t\t\t\tthis.activateGizmos( false );\r\n\t\t\t\tthis.dispatchEvent( _changeEvent );\r\n\r\n\t\t\t}\r\n\r\n\t\t} else if ( this._state == STATE.PAN || this._state == STATE.IDLE ) {\r\n\r\n\t\t\tthis.updateTbState( STATE.IDLE, false );\r\n\r\n\t\t\tif ( this.enableGrid ) {\r\n\r\n\t\t\t\tthis.disposeGrid();\r\n\r\n\t\t\t}\r\n\r\n\t\t\tthis.activateGizmos( false );\r\n\t\t\tthis.dispatchEvent( _changeEvent );\r\n\r\n\r\n\t\t}\r\n\r\n\t\tthis.dispatchEvent( _endEvent );\r\n\r\n\t}\r\n\r\n\tonDoubleTap( event ) {\r\n\r\n\t\tif ( this.enabled && this.enablePan && this.scene != null ) {\r\n\r\n\t\t\tthis.dispatchEvent( _startEvent );\r\n\r\n\t\t\tthis.setCenter( event.clientX, event.clientY );\r\n\t\t\tconst hitP = this.unprojectOnObj( this.getCursorNDC( _center.x, _center.y, this.domElement ), this.camera );\r\n\r\n\t\t\tif ( hitP != null && this.enableAnimations ) {\r\n\r\n\t\t\t\tconst self = this;\r\n\t\t\t\tif ( this._animationId != - 1 ) {\r\n\r\n\t\t\t\t\twindow.cancelAnimationFrame( this._animationId );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis._timeStart = - 1;\r\n\t\t\t\tthis._animationId = window.requestAnimationFrame( function ( t ) {\r\n\r\n\t\t\t\t\tself.updateTbState( STATE.ANIMATION_FOCUS, true );\r\n\t\t\t\t\tself.onFocusAnim( t, hitP, self._cameraMatrixState, self._gizmoMatrixState );\r\n\r\n\t\t\t\t} );\r\n\r\n\t\t\t} else if ( hitP != null && ! this.enableAnimations ) {\r\n\r\n\t\t\t\tthis.updateTbState( STATE.FOCUS, true );\r\n\t\t\t\tthis.focus( hitP, this.scaleFactor );\r\n\t\t\t\tthis.updateTbState( STATE.IDLE, false );\r\n\t\t\t\tthis.dispatchEvent( _changeEvent );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tthis.dispatchEvent( _endEvent );\r\n\r\n\t}\r\n\r\n\tonDoublePanStart() {\r\n\r\n\t\tif ( this.enabled && this.enablePan ) {\r\n\r\n\t\t\tthis.dispatchEvent( _startEvent );\r\n\r\n\t\t\tthis.updateTbState( STATE.PAN, true );\r\n\r\n\t\t\tthis.setCenter( ( this._touchCurrent[ 0 ].clientX + this._touchCurrent[ 1 ].clientX ) / 2, ( this._touchCurrent[ 0 ].clientY + this._touchCurrent[ 1 ].clientY ) / 2 );\r\n\t\t\tthis._startCursorPosition.copy( this.unprojectOnTbPlane( this.camera, _center.x, _center.y, this.domElement, true ) );\r\n\t\t\tthis._currentCursorPosition.copy( this._startCursorPosition );\r\n\r\n\t\t\tthis.activateGizmos( false );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tonDoublePanMove() {\r\n\r\n\t\tif ( this.enabled && this.enablePan ) {\r\n\r\n\t\t\tthis.setCenter( ( this._touchCurrent[ 0 ].clientX + this._touchCurrent[ 1 ].clientX ) / 2, ( this._touchCurrent[ 0 ].clientY + this._touchCurrent[ 1 ].clientY ) / 2 );\r\n\r\n\t\t\tif ( this._state != STATE.PAN ) {\r\n\r\n\t\t\t\tthis.updateTbState( STATE.PAN, true );\r\n\t\t\t\tthis._startCursorPosition.copy( this._currentCursorPosition );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tthis._currentCursorPosition.copy( this.unprojectOnTbPlane( this.camera, _center.x, _center.y, this.domElement, true ) );\r\n\t\t\tthis.applyTransformMatrix( this.pan( this._startCursorPosition, this._currentCursorPosition, true ) );\r\n\t\t\tthis.dispatchEvent( _changeEvent );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tonDoublePanEnd() {\r\n\r\n\t\tthis.updateTbState( STATE.IDLE, false );\r\n\t\tthis.dispatchEvent( _endEvent );\r\n\r\n\t}\r\n\r\n\tonRotateStart() {\r\n\r\n\t\tif ( this.enabled && this.enableRotate ) {\r\n\r\n\t\t\tthis.dispatchEvent( _startEvent );\r\n\r\n\t\t\tthis.updateTbState( STATE.ZROTATE, true );\r\n\r\n\t\t\t//this._startFingerRotation = event.rotation;\r\n\r\n\t\t\tthis._startFingerRotation = this.getAngle( this._touchCurrent[ 1 ], this._touchCurrent[ 0 ] ) + this.getAngle( this._touchStart[ 1 ], this._touchStart[ 0 ] );\r\n\t\t\tthis._currentFingerRotation = this._startFingerRotation;\r\n\r\n\t\t\tthis.camera.getWorldDirection( this._rotationAxis ); //rotation axis\r\n\r\n\t\t\tif ( ! this.enablePan && ! this.enableZoom ) {\r\n\r\n\t\t\t\tthis.activateGizmos( true );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tonRotateMove() {\r\n\r\n\t\tif ( this.enabled && this.enableRotate ) {\r\n\r\n\t\t\tthis.setCenter( ( this._touchCurrent[ 0 ].clientX + this._touchCurrent[ 1 ].clientX ) / 2, ( this._touchCurrent[ 0 ].clientY + this._touchCurrent[ 1 ].clientY ) / 2 );\r\n\t\t\tlet rotationPoint;\r\n\r\n\t\t\tif ( this._state != STATE.ZROTATE ) {\r\n\r\n\t\t\t\tthis.updateTbState( STATE.ZROTATE, true );\r\n\t\t\t\tthis._startFingerRotation = this._currentFingerRotation;\r\n\r\n\t\t\t}\r\n\r\n\t\t\t//this._currentFingerRotation = event.rotation;\r\n\t\t\tthis._currentFingerRotation = this.getAngle( this._touchCurrent[ 1 ], this._touchCurrent[ 0 ] ) + this.getAngle( this._touchStart[ 1 ], this._touchStart[ 0 ] );\r\n\r\n\t\t\tif ( ! this.enablePan ) {\r\n\r\n\t\t\t\trotationPoint = new Vector3().setFromMatrixPosition( this._gizmoMatrixState );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tthis._v3_2.setFromMatrixPosition( this._gizmoMatrixState );\r\n\t\t\t\trotationPoint = this.unprojectOnTbPlane( this.camera, _center.x, _center.y, this.domElement ).applyQuaternion( this.camera.quaternion ).multiplyScalar( 1 / this.camera.zoom ).add( this._v3_2 );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tconst amount = MathUtils.DEG2RAD * ( this._startFingerRotation - this._currentFingerRotation );\r\n\r\n\t\t\tthis.applyTransformMatrix( this.zRotate( rotationPoint, amount ) );\r\n\t\t\tthis.dispatchEvent( _changeEvent );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tonRotateEnd() {\r\n\r\n\t\tthis.updateTbState( STATE.IDLE, false );\r\n\t\tthis.activateGizmos( false );\r\n\t\tthis.dispatchEvent( _endEvent );\r\n\r\n\t}\r\n\r\n\tonPinchStart() {\r\n\r\n\t\tif ( this.enabled && this.enableZoom ) {\r\n\r\n\t\t\tthis.dispatchEvent( _startEvent );\r\n\t\t\tthis.updateTbState( STATE.SCALE, true );\r\n\r\n\t\t\tthis._startFingerDistance = this.calculatePointersDistance( this._touchCurrent[ 0 ], this._touchCurrent[ 1 ] );\r\n\t\t\tthis._currentFingerDistance = this._startFingerDistance;\r\n\r\n\t\t\tthis.activateGizmos( false );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tonPinchMove() {\r\n\r\n\t\tif ( this.enabled && this.enableZoom ) {\r\n\r\n\t\t\tthis.setCenter( ( this._touchCurrent[ 0 ].clientX + this._touchCurrent[ 1 ].clientX ) / 2, ( this._touchCurrent[ 0 ].clientY + this._touchCurrent[ 1 ].clientY ) / 2 );\r\n\t\t\tconst minDistance = 12; //minimum distance between fingers (in css pixels)\r\n\r\n\t\t\tif ( this._state != STATE.SCALE ) {\r\n\r\n\t\t\t\tthis._startFingerDistance = this._currentFingerDistance;\r\n\t\t\t\tthis.updateTbState( STATE.SCALE, true );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tthis._currentFingerDistance = Math.max( this.calculatePointersDistance( this._touchCurrent[ 0 ], this._touchCurrent[ 1 ] ), minDistance * this._devPxRatio );\r\n\t\t\tconst amount = this._currentFingerDistance / this._startFingerDistance;\r\n\r\n\t\t\tlet scalePoint;\r\n\r\n\t\t\tif ( ! this.enablePan ) {\r\n\r\n\t\t\t\tscalePoint = this._gizmos.position;\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tif ( this.camera.isOrthographicCamera ) {\r\n\r\n\t\t\t\t\tscalePoint = this.unprojectOnTbPlane( this.camera, _center.x, _center.y, this.domElement )\r\n\t\t\t\t\t\t.applyQuaternion( this.camera.quaternion )\r\n\t\t\t\t\t\t.multiplyScalar( 1 / this.camera.zoom )\r\n\t\t\t\t\t\t.add( this._gizmos.position );\r\n\r\n\t\t\t\t} else if ( this.camera.isPerspectiveCamera ) {\r\n\r\n\t\t\t\t\tscalePoint = this.unprojectOnTbPlane( this.camera, _center.x, _center.y, this.domElement )\r\n\t\t\t\t\t\t.applyQuaternion( this.camera.quaternion )\r\n\t\t\t\t\t\t.add( this._gizmos.position );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\tthis.applyTransformMatrix( this.scale( amount, scalePoint ) );\r\n\t\t\tthis.dispatchEvent( _changeEvent );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tonPinchEnd() {\r\n\r\n\t\tthis.updateTbState( STATE.IDLE, false );\r\n\t\tthis.dispatchEvent( _endEvent );\r\n\r\n\t}\r\n\r\n\tonTriplePanStart() {\r\n\r\n\t\tif ( this.enabled && this.enableZoom ) {\r\n\r\n\t\t\tthis.dispatchEvent( _startEvent );\r\n\r\n\t\t\tthis.updateTbState( STATE.SCALE, true );\r\n\r\n\t\t\t//const center = event.center;\r\n\t\t\tlet clientX = 0;\r\n\t\t\tlet clientY = 0;\r\n\t\t\tconst nFingers = this._touchCurrent.length;\r\n\r\n\t\t\tfor ( let i = 0; i < nFingers; i ++ ) {\r\n\r\n\t\t\t\tclientX += this._touchCurrent[ i ].clientX;\r\n\t\t\t\tclientY += this._touchCurrent[ i ].clientY;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tthis.setCenter( clientX / nFingers, clientY / nFingers );\r\n\r\n\t\t\tthis._startCursorPosition.setY( this.getCursorNDC( _center.x, _center.y, this.domElement ).y * 0.5 );\r\n\t\t\tthis._currentCursorPosition.copy( this._startCursorPosition );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tonTriplePanMove() {\r\n\r\n\t\tif ( this.enabled && this.enableZoom ) {\r\n\r\n\t\t\t//\t  fov / 2\r\n\t\t\t//\t\t|\\\r\n\t\t\t//\t\t| \\\r\n\t\t\t//\t\t|  \\\r\n\t\t\t//\tx\t|\t\\\r\n\t\t\t//\t\t| \t \\\r\n\t\t\t//\t\t| \t  \\\r\n\t\t\t//\t\t| _ _ _\\\r\n\t\t\t//\t\t\ty\r\n\r\n\t\t\t//const center = event.center;\r\n\t\t\tlet clientX = 0;\r\n\t\t\tlet clientY = 0;\r\n\t\t\tconst nFingers = this._touchCurrent.length;\r\n\r\n\t\t\tfor ( let i = 0; i < nFingers; i ++ ) {\r\n\r\n\t\t\t\tclientX += this._touchCurrent[ i ].clientX;\r\n\t\t\t\tclientY += this._touchCurrent[ i ].clientY;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tthis.setCenter( clientX / nFingers, clientY / nFingers );\r\n\r\n\t\t\tconst screenNotches = 8;\t//how many wheel notches corresponds to a full screen pan\r\n\t\t\tthis._currentCursorPosition.setY( this.getCursorNDC( _center.x, _center.y, this.domElement ).y * 0.5 );\r\n\r\n\t\t\tconst movement = this._currentCursorPosition.y - this._startCursorPosition.y;\r\n\r\n\t\t\tlet size = 1;\r\n\r\n\t\t\tif ( movement < 0 ) {\r\n\r\n\t\t\t\tsize = 1 / ( Math.pow( this.scaleFactor, - movement * screenNotches ) );\r\n\r\n\t\t\t} else if ( movement > 0 ) {\r\n\r\n\t\t\t\tsize = Math.pow( this.scaleFactor, movement * screenNotches );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tthis._v3_1.setFromMatrixPosition( this._cameraMatrixState );\r\n\t\t\tconst x = this._v3_1.distanceTo( this._gizmos.position );\r\n\t\t\tlet xNew = x / size; //distance between camera and gizmos if scale(size, scalepoint) would be performed\r\n\r\n\t\t\t//check min and max distance\r\n\t\t\txNew = MathUtils.clamp( xNew, this.minDistance, this.maxDistance );\r\n\r\n\t\t\tconst y = x * Math.tan( MathUtils.DEG2RAD * this._fovState * 0.5 );\r\n\r\n\t\t\t//calculate new fov\r\n\t\t\tlet newFov = MathUtils.RAD2DEG * ( Math.atan( y / xNew ) * 2 );\r\n\r\n\t\t\t//check min and max fov\r\n\t\t\tnewFov = MathUtils.clamp( newFov, this.minFov, this.maxFov );\r\n\r\n\t\t\tconst newDistance = y / Math.tan( MathUtils.DEG2RAD * ( newFov / 2 ) );\r\n\t\t\tsize = x / newDistance;\r\n\t\t\tthis._v3_2.setFromMatrixPosition( this._gizmoMatrixState );\r\n\r\n\t\t\tthis.setFov( newFov );\r\n\t\t\tthis.applyTransformMatrix( this.scale( size, this._v3_2, false ) );\r\n\r\n\t\t\t//adjusting distance\r\n\t\t\t_offset.copy( this._gizmos.position ).sub( this.camera.position ).normalize().multiplyScalar( newDistance / x );\r\n\t\t\tthis._m4_1.makeTranslation( _offset.x, _offset.y, _offset.z );\r\n\r\n\t\t\tthis.dispatchEvent( _changeEvent );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tonTriplePanEnd() {\r\n\r\n\t\tthis.updateTbState( STATE.IDLE, false );\r\n\t\tthis.dispatchEvent( _endEvent );\r\n\t\t//this.dispatchEvent( _changeEvent );\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Set _center's x/y coordinates\r\n\t * @param {Number} clientX\r\n\t * @param {Number} clientY\r\n\t */\r\n\tsetCenter( clientX, clientY ) {\r\n\r\n\t\t_center.x = clientX;\r\n\t\t_center.y = clientY;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Set default mouse actions\r\n\t */\r\n\tinitializeMouseActions() {\r\n\r\n\t\tthis.setMouseAction( 'PAN', 0, 'CTRL' );\r\n\t\tthis.setMouseAction( 'PAN', 2 );\r\n\r\n\t\tthis.setMouseAction( 'ROTATE', 0 );\r\n\r\n\t\tthis.setMouseAction( 'ZOOM', 'WHEEL' );\r\n\t\tthis.setMouseAction( 'ZOOM', 1 );\r\n\r\n\t\tthis.setMouseAction( 'FOV', 'WHEEL', 'SHIFT' );\r\n\t\tthis.setMouseAction( 'FOV', 1, 'SHIFT' );\r\n\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Compare two mouse actions\r\n\t * @param {Object} action1\r\n\t * @param {Object} action2\r\n\t * @returns {Boolean} True if action1 and action 2 are the same mouse action, false otherwise\r\n\t */\r\n\tcompareMouseAction( action1, action2 ) {\r\n\r\n\t\tif ( action1.operation == action2.operation ) {\r\n\r\n\t\t\tif ( action1.mouse == action2.mouse && action1.key == action2.key ) {\r\n\r\n\t\t\t\treturn true;\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\treturn false;\r\n\r\n\t\t\t}\r\n\r\n\t\t} else {\r\n\r\n\t\t\treturn false;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Set a new mouse action by specifying the operation to be performed and a mouse/key combination. In case of conflict, replaces the existing one\r\n\t * @param {String} operation The operation to be performed ('PAN', 'ROTATE', 'ZOOM', 'FOV)\r\n\t * @param {*} mouse A mouse button (0, 1, 2) or 'WHEEL' for wheel notches\r\n\t * @param {*} key The keyboard modifier ('CTRL', 'SHIFT') or null if key is not needed\r\n\t * @returns {Boolean} True if the mouse action has been successfully added, false otherwise\r\n\t */\r\n\tsetMouseAction( operation, mouse, key = null ) {\r\n\r\n\t\tconst operationInput = [ 'PAN', 'ROTATE', 'ZOOM', 'FOV' ];\r\n\t\tconst mouseInput = [ 0, 1, 2, 'WHEEL' ];\r\n\t\tconst keyInput = [ 'CTRL', 'SHIFT', null ];\r\n\t\tlet state;\r\n\r\n\t\tif ( ! operationInput.includes( operation ) || ! mouseInput.includes( mouse ) || ! keyInput.includes( key ) ) {\r\n\r\n\t\t\t//invalid parameters\r\n\t\t\treturn false;\r\n\r\n\t\t}\r\n\r\n\t\tif ( mouse == 'WHEEL' ) {\r\n\r\n\t\t\tif ( operation != 'ZOOM' && operation != 'FOV' ) {\r\n\r\n\t\t\t\t//cannot associate 2D operation to 1D input\r\n\t\t\t\treturn false;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tswitch ( operation ) {\r\n\r\n\t\t\tcase 'PAN':\r\n\r\n\t\t\t\tstate = STATE.PAN;\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'ROTATE':\r\n\r\n\t\t\t\tstate = STATE.ROTATE;\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'ZOOM':\r\n\r\n\t\t\t\tstate = STATE.SCALE;\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'FOV':\r\n\r\n\t\t\t\tstate = STATE.FOV;\r\n\t\t\t\tbreak;\r\n\r\n\t\t}\r\n\r\n\t\tconst action = {\r\n\r\n\t\t\toperation: operation,\r\n\t\t\tmouse: mouse,\r\n\t\t\tkey: key,\r\n\t\t\tstate: state\r\n\r\n\t\t};\r\n\r\n\t\tfor ( let i = 0; i < this.mouseActions.length; i ++ ) {\r\n\r\n\t\t\tif ( this.mouseActions[ i ].mouse == action.mouse && this.mouseActions[ i ].key == action.key ) {\r\n\r\n\t\t\t\tthis.mouseActions.splice( i, 1, action );\r\n\t\t\t\treturn true;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tthis.mouseActions.push( action );\r\n\t\treturn true;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Remove a mouse action by specifying its mouse/key combination\r\n\t * @param {*} mouse A mouse button (0, 1, 2) or 'WHEEL' for wheel notches\r\n\t * @param {*} key The keyboard modifier ('CTRL', 'SHIFT') or null if key is not needed\r\n\t * @returns {Boolean} True if the operation has been succesfully removed, false otherwise\r\n\t */\r\n\tunsetMouseAction( mouse, key = null ) {\r\n\r\n\t\tfor ( let i = 0; i < this.mouseActions.length; i ++ ) {\r\n\r\n\t\t\tif ( this.mouseActions[ i ].mouse == mouse && this.mouseActions[ i ].key == key ) {\r\n\r\n\t\t\t\tthis.mouseActions.splice( i, 1 );\r\n\t\t\t\treturn true;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\treturn false;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Return the operation associated to a mouse/keyboard combination\r\n\t * @param {*} mouse A mouse button (0, 1, 2) or 'WHEEL' for wheel notches\r\n\t * @param {*} key The keyboard modifier ('CTRL', 'SHIFT') or null if key is not needed\r\n\t * @returns The operation if it has been found, null otherwise\r\n\t */\r\n\tgetOpFromAction( mouse, key ) {\r\n\r\n\t\tlet action;\r\n\r\n\t\tfor ( let i = 0; i < this.mouseActions.length; i ++ ) {\r\n\r\n\t\t\taction = this.mouseActions[ i ];\r\n\t\t\tif ( action.mouse == mouse && action.key == key ) {\r\n\r\n\t\t\t\treturn action.operation;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tif ( key != null ) {\r\n\r\n\t\t\tfor ( let i = 0; i < this.mouseActions.length; i ++ ) {\r\n\r\n\t\t\t\taction = this.mouseActions[ i ];\r\n\t\t\t\tif ( action.mouse == mouse && action.key == null ) {\r\n\r\n\t\t\t\t\treturn action.operation;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\treturn null;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Get the operation associated to mouse and key combination and returns the corresponding FSA state\r\n\t * @param {Number} mouse Mouse button\r\n\t * @param {String} key Keyboard modifier\r\n\t * @returns The FSA state obtained from the operation associated to mouse/keyboard combination\r\n\t */\r\n\tgetOpStateFromAction( mouse, key ) {\r\n\r\n\t\tlet action;\r\n\r\n\t\tfor ( let i = 0; i < this.mouseActions.length; i ++ ) {\r\n\r\n\t\t\taction = this.mouseActions[ i ];\r\n\t\t\tif ( action.mouse == mouse && action.key == key ) {\r\n\r\n\t\t\t\treturn action.state;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tif ( key != null ) {\r\n\r\n\t\t\tfor ( let i = 0; i < this.mouseActions.length; i ++ ) {\r\n\r\n\t\t\t\taction = this.mouseActions[ i ];\r\n\t\t\t\tif ( action.mouse == mouse && action.key == null ) {\r\n\r\n\t\t\t\t\treturn action.state;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\treturn null;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Calculate the angle between two pointers\r\n\t * @param {PointerEvent} p1\r\n\t * @param {PointerEvent} p2\r\n\t * @returns {Number} The angle between two pointers in degrees\r\n\t */\r\n\tgetAngle( p1, p2 ) {\r\n\r\n\t\treturn Math.atan2( p2.clientY - p1.clientY, p2.clientX - p1.clientX ) * 180 / Math.PI;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Update a PointerEvent inside current pointerevents array\r\n\t * @param {PointerEvent} event\r\n\t */\r\n\tupdateTouchEvent( event ) {\r\n\r\n\t\tfor ( let i = 0; i < this._touchCurrent.length; i ++ ) {\r\n\r\n\t\t\tif ( this._touchCurrent[ i ].pointerId == event.pointerId ) {\r\n\r\n\t\t\t\tthis._touchCurrent.splice( i, 1, event );\r\n\t\t\t\tbreak;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Apply a transformation matrix, to the camera and gizmos\r\n\t * @param {Object} transformation Object containing matrices to apply to camera and gizmos\r\n\t */\r\n\tapplyTransformMatrix( transformation ) {\r\n\r\n\t\tif ( transformation.camera != null ) {\r\n\r\n\t\t\tthis._m4_1.copy( this._cameraMatrixState ).premultiply( transformation.camera );\r\n\t\t\tthis._m4_1.decompose( this.camera.position, this.camera.quaternion, this.camera.scale );\r\n\t\t\tthis.camera.updateMatrix();\r\n\r\n\t\t\t//update camera up vector\r\n\t\t\tif ( this._state == STATE.ROTATE || this._state == STATE.ZROTATE || this._state == STATE.ANIMATION_ROTATE ) {\r\n\r\n\t\t\t\tthis.camera.up.copy( this._upState ).applyQuaternion( this.camera.quaternion );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tif ( transformation.gizmos != null ) {\r\n\r\n\t\t\tthis._m4_1.copy( this._gizmoMatrixState ).premultiply( transformation.gizmos );\r\n\t\t\tthis._m4_1.decompose( this._gizmos.position, this._gizmos.quaternion, this._gizmos.scale );\r\n\t\t\tthis._gizmos.updateMatrix();\r\n\r\n\t\t}\r\n\r\n\t\tif ( this._state == STATE.SCALE || this._state == STATE.FOCUS || this._state == STATE.ANIMATION_FOCUS ) {\r\n\r\n\t\t\tthis._tbRadius = this.calculateTbRadius( this.camera );\r\n\r\n\t\t\tif ( this.adjustNearFar ) {\r\n\r\n\t\t\t\tconst cameraDistance = this.camera.position.distanceTo( this._gizmos.position );\r\n\r\n\t\t\t\tconst bb = new Box3();\r\n\t\t\t\tbb.setFromObject( this._gizmos );\r\n\t\t\t\tconst sphere = new Sphere();\r\n\t\t\t\tbb.getBoundingSphere( sphere );\r\n\r\n\t\t\t\tconst adjustedNearPosition = Math.max( this._nearPos0, sphere.radius + sphere.center.length() );\r\n\t\t\t\tconst regularNearPosition = cameraDistance - this._initialNear;\r\n\r\n\t\t\t\tconst minNearPos = Math.min( adjustedNearPosition, regularNearPosition );\r\n\t\t\t\tthis.camera.near = cameraDistance - minNearPos;\r\n\r\n\r\n\t\t\t\tconst adjustedFarPosition = Math.min( this._farPos0, - sphere.radius + sphere.center.length() );\r\n\t\t\t\tconst regularFarPosition = cameraDistance - this._initialFar;\r\n\r\n\t\t\t\tconst minFarPos = Math.min( adjustedFarPosition, regularFarPosition );\r\n\t\t\t\tthis.camera.far = cameraDistance - minFarPos;\r\n\r\n\t\t\t\tthis.camera.updateProjectionMatrix();\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tlet update = false;\r\n\r\n\t\t\t\tif ( this.camera.near != this._initialNear ) {\r\n\r\n\t\t\t\t\tthis.camera.near = this._initialNear;\r\n\t\t\t\t\tupdate = true;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( this.camera.far != this._initialFar ) {\r\n\r\n\t\t\t\t\tthis.camera.far = this._initialFar;\r\n\t\t\t\t\tupdate = true;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( update ) {\r\n\r\n\t\t\t\t\tthis.camera.updateProjectionMatrix();\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Calculate the angular speed\r\n\t * @param {Number} p0 Position at t0\r\n\t * @param {Number} p1 Position at t1\r\n\t * @param {Number} t0 Initial time in milliseconds\r\n\t * @param {Number} t1 Ending time in milliseconds\r\n\t */\r\n\tcalculateAngularSpeed( p0, p1, t0, t1 ) {\r\n\r\n\t\tconst s = p1 - p0;\r\n\t\tconst t = ( t1 - t0 ) / 1000;\r\n\t\tif ( t == 0 ) {\r\n\r\n\t\t\treturn 0;\r\n\r\n\t\t}\r\n\r\n\t\treturn s / t;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Calculate the distance between two pointers\r\n\t * @param {PointerEvent} p0 The first pointer\r\n\t * @param {PointerEvent} p1 The second pointer\r\n\t * @returns {number} The distance between the two pointers\r\n\t */\r\n\tcalculatePointersDistance( p0, p1 ) {\r\n\r\n\t\treturn Math.sqrt( Math.pow( p1.clientX - p0.clientX, 2 ) + Math.pow( p1.clientY - p0.clientY, 2 ) );\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Calculate the rotation axis as the vector perpendicular between two vectors\r\n\t * @param {Vector3} vec1 The first vector\r\n\t * @param {Vector3} vec2 The second vector\r\n\t * @returns {Vector3} The normalized rotation axis\r\n\t */\r\n\tcalculateRotationAxis( vec1, vec2 ) {\r\n\r\n\t\tthis._rotationMatrix.extractRotation( this._cameraMatrixState );\r\n\t\tthis._quat.setFromRotationMatrix( this._rotationMatrix );\r\n\r\n\t\tthis._rotationAxis.crossVectors( vec1, vec2 ).applyQuaternion( this._quat );\r\n\t\treturn this._rotationAxis.normalize().clone();\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Calculate the trackball radius so that gizmo's diamater will be 2/3 of the minimum side of the camera frustum\r\n\t * @param {Camera} camera\r\n\t * @returns {Number} The trackball radius\r\n\t */\r\n\tcalculateTbRadius( camera ) {\r\n\r\n\t\tconst distance = camera.position.distanceTo( this._gizmos.position );\r\n\r\n\t\tif ( camera.type == 'PerspectiveCamera' ) {\r\n\r\n\t\t\tconst halfFovV = MathUtils.DEG2RAD * camera.fov * 0.5; //vertical fov/2 in radians\r\n\t\t\tconst halfFovH = Math.atan( ( camera.aspect ) * Math.tan( halfFovV ) ); //horizontal fov/2 in radians\r\n\t\t\treturn Math.tan( Math.min( halfFovV, halfFovH ) ) * distance * this.radiusFactor;\r\n\r\n\t\t} else if ( camera.type == 'OrthographicCamera' ) {\r\n\r\n\t\t\treturn Math.min( camera.top, camera.right ) * this.radiusFactor;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Focus operation consist of positioning the point of interest in front of the camera and a slightly zoom in\r\n\t * @param {Vector3} point The point of interest\r\n\t * @param {Number} size Scale factor\r\n\t * @param {Number} amount Amount of operation to be completed (used for focus animations, default is complete full operation)\r\n\t */\r\n\tfocus( point, size, amount = 1 ) {\r\n\r\n\t\t//move center of camera (along with gizmos) towards point of interest\r\n\t\t_offset.copy( point ).sub( this._gizmos.position ).multiplyScalar( amount );\r\n\t\tthis._translationMatrix.makeTranslation( _offset.x, _offset.y, _offset.z );\r\n\r\n\t\t_gizmoMatrixStateTemp.copy( this._gizmoMatrixState );\r\n\t\tthis._gizmoMatrixState.premultiply( this._translationMatrix );\r\n\t\tthis._gizmoMatrixState.decompose( this._gizmos.position, this._gizmos.quaternion, this._gizmos.scale );\r\n\r\n\t\t_cameraMatrixStateTemp.copy( this._cameraMatrixState );\r\n\t\tthis._cameraMatrixState.premultiply( this._translationMatrix );\r\n\t\tthis._cameraMatrixState.decompose( this.camera.position, this.camera.quaternion, this.camera.scale );\r\n\r\n\t\t//apply zoom\r\n\t\tif ( this.enableZoom ) {\r\n\r\n\t\t\tthis.applyTransformMatrix( this.scale( size, this._gizmos.position ) );\r\n\r\n\t\t}\r\n\r\n\t\tthis._gizmoMatrixState.copy( _gizmoMatrixStateTemp );\r\n\t\tthis._cameraMatrixState.copy( _cameraMatrixStateTemp );\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Draw a grid and add it to the scene\r\n\t */\r\n\tdrawGrid() {\r\n\r\n\t\tif ( this.scene != null ) {\r\n\r\n\t\t\tconst color = 0x888888;\r\n\t\t\tconst multiplier = 3;\r\n\t\t\tlet size, divisions, maxLength, tick;\r\n\r\n\t\t\tif ( this.camera.isOrthographicCamera ) {\r\n\r\n\t\t\t\tconst width = this.camera.right - this.camera.left;\r\n\t\t\t\tconst height = this.camera.bottom - this.camera.top;\r\n\r\n\t\t\t\tmaxLength = Math.max( width, height );\r\n\t\t\t\ttick = maxLength / 20;\r\n\r\n\t\t\t\tsize = maxLength / this.camera.zoom * multiplier;\r\n\t\t\t\tdivisions = size / tick * this.camera.zoom;\r\n\r\n\t\t\t} else if ( this.camera.isPerspectiveCamera ) {\r\n\r\n\t\t\t\tconst distance = this.camera.position.distanceTo( this._gizmos.position );\r\n\t\t\t\tconst halfFovV = MathUtils.DEG2RAD * this.camera.fov * 0.5;\r\n\t\t\t\tconst halfFovH = Math.atan( ( this.camera.aspect ) * Math.tan( halfFovV ) );\r\n\r\n\t\t\t\tmaxLength = Math.tan( Math.max( halfFovV, halfFovH ) ) * distance * 2;\r\n\t\t\t\ttick = maxLength / 20;\r\n\r\n\t\t\t\tsize = maxLength * multiplier;\r\n\t\t\t\tdivisions = size / tick;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif ( this._grid == null ) {\r\n\r\n\t\t\t\tthis._grid = new GridHelper( size, divisions, color, color );\r\n\t\t\t\tthis._grid.position.copy( this._gizmos.position );\r\n\t\t\t\tthis._gridPosition.copy( this._grid.position );\r\n\t\t\t\tthis._grid.quaternion.copy( this.camera.quaternion );\r\n\t\t\t\tthis._grid.rotateX( Math.PI * 0.5 );\r\n\r\n\t\t\t\tthis.scene.add( this._grid );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Remove all listeners, stop animations and clean scene\r\n\t */\r\n\tdispose() {\r\n\r\n\t\tif ( this._animationId != - 1 ) {\r\n\r\n\t\t\twindow.cancelAnimationFrame( this._animationId );\r\n\r\n\t\t}\r\n\r\n\t\tthis.domElement.removeEventListener( 'pointerdown', this._onPointerDown );\r\n\t\tthis.domElement.removeEventListener( 'pointercancel', this._onPointerCancel );\r\n\t\tthis.domElement.removeEventListener( 'wheel', this._onWheel );\r\n\t\tthis.domElement.removeEventListener( 'contextmenu', this._onContextMenu );\r\n\r\n\t\twindow.removeEventListener( 'pointermove', this._onPointerMove );\r\n\t\twindow.removeEventListener( 'pointerup', this._onPointerUp );\r\n\r\n\t\twindow.removeEventListener( 'resize', this._onWindowResize );\r\n\r\n\t\tif ( this.scene !== null ) this.scene.remove( this._gizmos );\r\n\t\tthis.disposeGrid();\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * remove the grid from the scene\r\n\t */\r\n\tdisposeGrid() {\r\n\r\n\t\tif ( this._grid != null && this.scene != null ) {\r\n\r\n\t\t\tthis.scene.remove( this._grid );\r\n\t\t\tthis._grid = null;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Compute the easing out cubic function for ease out effect in animation\r\n\t * @param {Number} t The absolute progress of the animation in the bound of 0 (beginning of the) and 1 (ending of animation)\r\n\t * @returns {Number} Result of easing out cubic at time t\r\n\t */\r\n\teaseOutCubic( t ) {\r\n\r\n\t\treturn 1 - Math.pow( 1 - t, 3 );\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Make rotation gizmos more or less visible\r\n\t * @param {Boolean} isActive If true, make gizmos more visible\r\n\t */\r\n\tactivateGizmos( isActive ) {\r\n\r\n\t\tconst gizmoX = this._gizmos.children[ 0 ];\r\n\t\tconst gizmoY = this._gizmos.children[ 1 ];\r\n\t\tconst gizmoZ = this._gizmos.children[ 2 ];\r\n\r\n\t\tif ( isActive ) {\r\n\r\n\t\t\tgizmoX.material.setValues( { opacity: 1 } );\r\n\t\t\tgizmoY.material.setValues( { opacity: 1 } );\r\n\t\t\tgizmoZ.material.setValues( { opacity: 1 } );\r\n\r\n\t\t} else {\r\n\r\n\t\t\tgizmoX.material.setValues( { opacity: 0.6 } );\r\n\t\t\tgizmoY.material.setValues( { opacity: 0.6 } );\r\n\t\t\tgizmoZ.material.setValues( { opacity: 0.6 } );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Calculate the cursor position in NDC\r\n\t * @param {number} x Cursor horizontal coordinate within the canvas\r\n\t * @param {number} y Cursor vertical coordinate within the canvas\r\n\t * @param {HTMLElement} canvas The canvas where the renderer draws its output\r\n\t * @returns {Vector2} Cursor normalized position inside the canvas\r\n\t */\r\n\tgetCursorNDC( cursorX, cursorY, canvas ) {\r\n\r\n\t\tconst canvasRect = canvas.getBoundingClientRect();\r\n\t\tthis._v2_1.setX( ( ( cursorX - canvasRect.left ) / canvasRect.width ) * 2 - 1 );\r\n\t\tthis._v2_1.setY( ( ( canvasRect.bottom - cursorY ) / canvasRect.height ) * 2 - 1 );\r\n\t\treturn this._v2_1.clone();\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Calculate the cursor position inside the canvas x/y coordinates with the origin being in the center of the canvas\r\n\t * @param {Number} x Cursor horizontal coordinate within the canvas\r\n\t * @param {Number} y Cursor vertical coordinate within the canvas\r\n\t * @param {HTMLElement} canvas The canvas where the renderer draws its output\r\n\t * @returns {Vector2} Cursor position inside the canvas\r\n\t */\r\n\tgetCursorPosition( cursorX, cursorY, canvas ) {\r\n\r\n\t\tthis._v2_1.copy( this.getCursorNDC( cursorX, cursorY, canvas ) );\r\n\t\tthis._v2_1.x *= ( this.camera.right - this.camera.left ) * 0.5;\r\n\t\tthis._v2_1.y *= ( this.camera.top - this.camera.bottom ) * 0.5;\r\n\t\treturn this._v2_1.clone();\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Set the camera to be controlled\r\n\t * @param {Camera} camera The virtual camera to be controlled\r\n\t */\r\n\tsetCamera( camera ) {\r\n\r\n\t\tcamera.lookAt( this.target );\r\n\t\tcamera.updateMatrix();\r\n\r\n\t\t//setting state\r\n\t\tif ( camera.type == 'PerspectiveCamera' ) {\r\n\r\n\t\t\tthis._fov0 = camera.fov;\r\n\t\t\tthis._fovState = camera.fov;\r\n\r\n\t\t}\r\n\r\n\t\tthis._cameraMatrixState0.copy( camera.matrix );\r\n\t\tthis._cameraMatrixState.copy( this._cameraMatrixState0 );\r\n\t\tthis._cameraProjectionState.copy( camera.projectionMatrix );\r\n\t\tthis._zoom0 = camera.zoom;\r\n\t\tthis._zoomState = this._zoom0;\r\n\r\n\t\tthis._initialNear = camera.near;\r\n\t\tthis._nearPos0 = camera.position.distanceTo( this.target ) - camera.near;\r\n\t\tthis._nearPos = this._initialNear;\r\n\r\n\t\tthis._initialFar = camera.far;\r\n\t\tthis._farPos0 = camera.position.distanceTo( this.target ) - camera.far;\r\n\t\tthis._farPos = this._initialFar;\r\n\r\n\t\tthis._up0.copy( camera.up );\r\n\t\tthis._upState.copy( camera.up );\r\n\r\n\t\tthis.camera = camera;\r\n\t\tthis.camera.updateProjectionMatrix();\r\n\r\n\t\t//making gizmos\r\n\t\tthis._tbRadius = this.calculateTbRadius( camera );\r\n\t\tthis.makeGizmos( this.target, this._tbRadius );\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Set gizmos visibility\r\n\t * @param {Boolean} value Value of gizmos visibility\r\n\t */\r\n\tsetGizmosVisible( value ) {\r\n\r\n\t\tthis._gizmos.visible = value;\r\n\t\tthis.dispatchEvent( _changeEvent );\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Set gizmos radius factor and redraws gizmos\r\n\t * @param {Float} value Value of radius factor\r\n\t */\r\n\tsetTbRadius( value ) {\r\n\r\n\t\tthis.radiusFactor = value;\r\n\t\tthis._tbRadius = this.calculateTbRadius( this.camera );\r\n\r\n\t\tconst curve = new EllipseCurve( 0, 0, this._tbRadius, this._tbRadius );\r\n\t\tconst points = curve.getPoints( this._curvePts );\r\n\t\tconst curveGeometry = new BufferGeometry().setFromPoints( points );\r\n\r\n\r\n\t\tfor ( const gizmo in this._gizmos.children ) {\r\n\r\n\t\t\tthis._gizmos.children[ gizmo ].geometry = curveGeometry;\r\n\r\n\t\t}\r\n\r\n\t\tthis.dispatchEvent( _changeEvent );\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Creates the rotation gizmos matching trackball center and radius\r\n\t * @param {Vector3} tbCenter The trackball center\r\n\t * @param {number} tbRadius The trackball radius\r\n\t */\r\n\tmakeGizmos( tbCenter, tbRadius ) {\r\n\r\n\t\tconst curve = new EllipseCurve( 0, 0, tbRadius, tbRadius );\r\n\t\tconst points = curve.getPoints( this._curvePts );\r\n\r\n\t\t//geometry\r\n\t\tconst curveGeometry = new BufferGeometry().setFromPoints( points );\r\n\r\n\t\t//material\r\n\t\tconst curveMaterialX = new LineBasicMaterial( { color: 0xff8080, fog: false, transparent: true, opacity: 0.6 } );\r\n\t\tconst curveMaterialY = new LineBasicMaterial( { color: 0x80ff80, fog: false, transparent: true, opacity: 0.6 } );\r\n\t\tconst curveMaterialZ = new LineBasicMaterial( { color: 0x8080ff, fog: false, transparent: true, opacity: 0.6 } );\r\n\r\n\t\t//line\r\n\t\tconst gizmoX = new Line( curveGeometry, curveMaterialX );\r\n\t\tconst gizmoY = new Line( curveGeometry, curveMaterialY );\r\n\t\tconst gizmoZ = new Line( curveGeometry, curveMaterialZ );\r\n\r\n\t\tconst rotation = Math.PI * 0.5;\r\n\t\tgizmoX.rotation.x = rotation;\r\n\t\tgizmoY.rotation.y = rotation;\r\n\r\n\r\n\t\t//setting state\r\n\t\tthis._gizmoMatrixState0.identity().setPosition( tbCenter );\r\n\t\tthis._gizmoMatrixState.copy( this._gizmoMatrixState0 );\r\n\r\n\t\tif ( this.camera.zoom !== 1 ) {\r\n\r\n\t\t\t//adapt gizmos size to camera zoom\r\n\t\t\tconst size = 1 / this.camera.zoom;\r\n\t\t\tthis._scaleMatrix.makeScale( size, size, size );\r\n\t\t\tthis._translationMatrix.makeTranslation( - tbCenter.x, - tbCenter.y, - tbCenter.z );\r\n\r\n\t\t\tthis._gizmoMatrixState.premultiply( this._translationMatrix ).premultiply( this._scaleMatrix );\r\n\t\t\tthis._translationMatrix.makeTranslation( tbCenter.x, tbCenter.y, tbCenter.z );\r\n\t\t\tthis._gizmoMatrixState.premultiply( this._translationMatrix );\r\n\r\n\t\t}\r\n\r\n\t\tthis._gizmoMatrixState.decompose( this._gizmos.position, this._gizmos.quaternion, this._gizmos.scale );\r\n\r\n\t\t//\r\n\r\n\t\tthis._gizmos.traverse( function ( object ) {\r\n\r\n\t\t\tif ( object.isLine ) {\r\n\r\n\t\t\t\tobject.geometry.dispose();\r\n\t\t\t\tobject.material.dispose();\r\n\r\n\t\t\t}\r\n\r\n\t\t} );\r\n\r\n\t\tthis._gizmos.clear();\r\n\r\n\t\t//\r\n\r\n\t\tthis._gizmos.add( gizmoX );\r\n\t\tthis._gizmos.add( gizmoY );\r\n\t\tthis._gizmos.add( gizmoZ );\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Perform animation for focus operation\r\n\t * @param {Number} time Instant in which this function is called as performance.now()\r\n\t * @param {Vector3} point Point of interest for focus operation\r\n\t * @param {Matrix4} cameraMatrix Camera matrix\r\n\t * @param {Matrix4} gizmoMatrix Gizmos matrix\r\n\t */\r\n\tonFocusAnim( time, point, cameraMatrix, gizmoMatrix ) {\r\n\r\n\t\tif ( this._timeStart == - 1 ) {\r\n\r\n\t\t\t//animation start\r\n\t\t\tthis._timeStart = time;\r\n\r\n\t\t}\r\n\r\n\t\tif ( this._state == STATE.ANIMATION_FOCUS ) {\r\n\r\n\t\t\tconst deltaTime = time - this._timeStart;\r\n\t\t\tconst animTime = deltaTime / this.focusAnimationTime;\r\n\r\n\t\t\tthis._gizmoMatrixState.copy( gizmoMatrix );\r\n\r\n\t\t\tif ( animTime >= 1 ) {\r\n\r\n\t\t\t\t//animation end\r\n\r\n\t\t\t\tthis._gizmoMatrixState.decompose( this._gizmos.position, this._gizmos.quaternion, this._gizmos.scale );\r\n\r\n\t\t\t\tthis.focus( point, this.scaleFactor );\r\n\r\n\t\t\t\tthis._timeStart = - 1;\r\n\t\t\t\tthis.updateTbState( STATE.IDLE, false );\r\n\t\t\t\tthis.activateGizmos( false );\r\n\r\n\t\t\t\tthis.dispatchEvent( _changeEvent );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tconst amount = this.easeOutCubic( animTime );\r\n\t\t\t\tconst size = ( ( 1 - amount ) + ( this.scaleFactor * amount ) );\r\n\r\n\t\t\t\tthis._gizmoMatrixState.decompose( this._gizmos.position, this._gizmos.quaternion, this._gizmos.scale );\r\n\t\t\t\tthis.focus( point, size, amount );\r\n\r\n\t\t\t\tthis.dispatchEvent( _changeEvent );\r\n\t\t\t\tconst self = this;\r\n\t\t\t\tthis._animationId = window.requestAnimationFrame( function ( t ) {\r\n\r\n\t\t\t\t\tself.onFocusAnim( t, point, cameraMatrix, gizmoMatrix.clone() );\r\n\r\n\t\t\t\t} );\r\n\r\n\t\t\t}\r\n\r\n\t\t} else {\r\n\r\n\t\t\t//interrupt animation\r\n\r\n\t\t\tthis._animationId = - 1;\r\n\t\t\tthis._timeStart = - 1;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Perform animation for rotation operation\r\n\t * @param {Number} time Instant in which this function is called as performance.now()\r\n\t * @param {Vector3} rotationAxis Rotation axis\r\n\t * @param {number} w0 Initial angular velocity\r\n\t */\r\n\tonRotationAnim( time, rotationAxis, w0 ) {\r\n\r\n\t\tif ( this._timeStart == - 1 ) {\r\n\r\n\t\t\t//animation start\r\n\t\t\tthis._anglePrev = 0;\r\n\t\t\tthis._angleCurrent = 0;\r\n\t\t\tthis._timeStart = time;\r\n\r\n\t\t}\r\n\r\n\t\tif ( this._state == STATE.ANIMATION_ROTATE ) {\r\n\r\n\t\t\t//w = w0 + alpha * t\r\n\t\t\tconst deltaTime = ( time - this._timeStart ) / 1000;\r\n\t\t\tconst w = w0 + ( ( - this.dampingFactor ) * deltaTime );\r\n\r\n\t\t\tif ( w > 0 ) {\r\n\r\n\t\t\t\t//tetha = 0.5 * alpha * t^2 + w0 * t + tetha0\r\n\t\t\t\tthis._angleCurrent = 0.5 * ( - this.dampingFactor ) * Math.pow( deltaTime, 2 ) + w0 * deltaTime + 0;\r\n\t\t\t\tthis.applyTransformMatrix( this.rotate( rotationAxis, this._angleCurrent ) );\r\n\t\t\t\tthis.dispatchEvent( _changeEvent );\r\n\t\t\t\tconst self = this;\r\n\t\t\t\tthis._animationId = window.requestAnimationFrame( function ( t ) {\r\n\r\n\t\t\t\t\tself.onRotationAnim( t, rotationAxis, w0 );\r\n\r\n\t\t\t\t} );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tthis._animationId = - 1;\r\n\t\t\t\tthis._timeStart = - 1;\r\n\r\n\t\t\t\tthis.updateTbState( STATE.IDLE, false );\r\n\t\t\t\tthis.activateGizmos( false );\r\n\r\n\t\t\t\tthis.dispatchEvent( _changeEvent );\r\n\r\n\t\t\t}\r\n\r\n\t\t} else {\r\n\r\n\t\t\t//interrupt animation\r\n\r\n\t\t\tthis._animationId = - 1;\r\n\t\t\tthis._timeStart = - 1;\r\n\r\n\t\t\tif ( this._state != STATE.ROTATE ) {\r\n\r\n\t\t\t\tthis.activateGizmos( false );\r\n\t\t\t\tthis.dispatchEvent( _changeEvent );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * Perform pan operation moving camera between two points\r\n\t * @param {Vector3} p0 Initial point\r\n\t * @param {Vector3} p1 Ending point\r\n\t * @param {Boolean} adjust If movement should be adjusted considering camera distance (Perspective only)\r\n\t */\r\n\tpan( p0, p1, adjust = false ) {\r\n\r\n\t\tconst movement = p0.clone().sub( p1 );\r\n\r\n\t\tif ( this.camera.isOrthographicCamera ) {\r\n\r\n\t\t\t//adjust movement amount\r\n\t\t\tmovement.multiplyScalar( 1 / this.camera.zoom );\r\n\r\n\t\t} else if ( this.camera.isPerspectiveCamera && adjust ) {\r\n\r\n\t\t\t//adjust movement amount\r\n\t\t\tthis._v3_1.setFromMatrixPosition( this._cameraMatrixState0 );\t//camera's initial position\r\n\t\t\tthis._v3_2.setFromMatrixPosition( this._gizmoMatrixState0 );\t//gizmo's initial position\r\n\t\t\tconst distanceFactor = this._v3_1.distanceTo( this._v3_2 ) / this.camera.position.distanceTo( this._gizmos.position );\r\n\t\t\tmovement.multiplyScalar( 1 / distanceFactor );\r\n\r\n\t\t}\r\n\r\n\t\tthis._v3_1.set( movement.x, movement.y, 0 ).applyQuaternion( this.camera.quaternion );\r\n\r\n\t\tthis._m4_1.makeTranslation( this._v3_1.x, this._v3_1.y, this._v3_1.z );\r\n\r\n\t\tthis.setTransformationMatrices( this._m4_1, this._m4_1 );\r\n\t\treturn _transformation;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Reset trackball\r\n\t */\r\n\treset() {\r\n\r\n\t\tthis.camera.zoom = this._zoom0;\r\n\r\n\t\tif ( this.camera.isPerspectiveCamera ) {\r\n\r\n\t\t\tthis.camera.fov = this._fov0;\r\n\r\n\t\t}\r\n\r\n\t\tthis.camera.near = this._nearPos;\r\n\t\tthis.camera.far = this._farPos;\r\n\t\tthis._cameraMatrixState.copy( this._cameraMatrixState0 );\r\n\t\tthis._cameraMatrixState.decompose( this.camera.position, this.camera.quaternion, this.camera.scale );\r\n\t\tthis.camera.up.copy( this._up0 );\r\n\r\n\t\tthis.camera.updateMatrix();\r\n\t\tthis.camera.updateProjectionMatrix();\r\n\r\n\t\tthis._gizmoMatrixState.copy( this._gizmoMatrixState0 );\r\n\t\tthis._gizmoMatrixState0.decompose( this._gizmos.position, this._gizmos.quaternion, this._gizmos.scale );\r\n\t\tthis._gizmos.updateMatrix();\r\n\r\n\t\tthis._tbRadius = this.calculateTbRadius( this.camera );\r\n\t\tthis.makeGizmos( this._gizmos.position, this._tbRadius );\r\n\r\n\t\tthis.camera.lookAt( this._gizmos.position );\r\n\r\n\t\tthis.updateTbState( STATE.IDLE, false );\r\n\r\n\t\tthis.dispatchEvent( _changeEvent );\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Rotate the camera around an axis passing by trackball's center\r\n\t * @param {Vector3} axis Rotation axis\r\n\t * @param {number} angle Angle in radians\r\n\t * @returns {Object} Object with 'camera' field containing transformation matrix resulting from the operation to be applied to the camera\r\n\t */\r\n\trotate( axis, angle ) {\r\n\r\n\t\tconst point = this._gizmos.position; //rotation center\r\n\t\tthis._translationMatrix.makeTranslation( - point.x, - point.y, - point.z );\r\n\t\tthis._rotationMatrix.makeRotationAxis( axis, - angle );\r\n\r\n\t\t//rotate camera\r\n\t\tthis._m4_1.makeTranslation( point.x, point.y, point.z );\r\n\t\tthis._m4_1.multiply( this._rotationMatrix );\r\n\t\tthis._m4_1.multiply( this._translationMatrix );\r\n\r\n\t\tthis.setTransformationMatrices( this._m4_1 );\r\n\r\n\t\treturn _transformation;\r\n\r\n\t}\r\n\r\n\tcopyState() {\r\n\r\n\t\tlet state;\r\n\t\tif ( this.camera.isOrthographicCamera ) {\r\n\r\n\t\t\tstate = JSON.stringify( { arcballState: {\r\n\r\n\t\t\t\tcameraFar: this.camera.far,\r\n\t\t\t\tcameraMatrix: this.camera.matrix,\r\n\t\t\t\tcameraNear: this.camera.near,\r\n\t\t\t\tcameraUp: this.camera.up,\r\n\t\t\t\tcameraZoom: this.camera.zoom,\r\n\t\t\t\tgizmoMatrix: this._gizmos.matrix\r\n\r\n\t\t\t} } );\r\n\r\n\t\t} else if ( this.camera.isPerspectiveCamera ) {\r\n\r\n\t\t\tstate = JSON.stringify( { arcballState: {\r\n\t\t\t\tcameraFar: this.camera.far,\r\n\t\t\t\tcameraFov: this.camera.fov,\r\n\t\t\t\tcameraMatrix: this.camera.matrix,\r\n\t\t\t\tcameraNear: this.camera.near,\r\n\t\t\t\tcameraUp: this.camera.up,\r\n\t\t\t\tcameraZoom: this.camera.zoom,\r\n\t\t\t\tgizmoMatrix: this._gizmos.matrix\r\n\r\n\t\t\t} } );\r\n\r\n\t\t}\r\n\r\n\t\tnavigator.clipboard.writeText( state );\r\n\r\n\t}\r\n\r\n\tpasteState() {\r\n\r\n\t\tconst self = this;\r\n\t\tnavigator.clipboard.readText().then( function resolved( value ) {\r\n\r\n\t\t\tself.setStateFromJSON( value );\r\n\r\n\t\t} );\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Save the current state of the control. This can later be recover with .reset\r\n\t */\r\n\tsaveState() {\r\n\r\n\t\tthis._cameraMatrixState0.copy( this.camera.matrix );\r\n\t\tthis._gizmoMatrixState0.copy( this._gizmos.matrix );\r\n\t\tthis._nearPos = this.camera.near;\r\n\t\tthis._farPos = this.camera.far;\r\n\t\tthis._zoom0 = this.camera.zoom;\r\n\t\tthis._up0.copy( this.camera.up );\r\n\r\n\t\tif ( this.camera.isPerspectiveCamera ) {\r\n\r\n\t\t\tthis._fov0 = this.camera.fov;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Perform uniform scale operation around a given point\r\n\t * @param {Number} size Scale factor\r\n\t * @param {Vector3} point Point around which scale\r\n\t * @param {Boolean} scaleGizmos If gizmos should be scaled (Perspective only)\r\n\t * @returns {Object} Object with 'camera' and 'gizmo' fields containing transformation matrices resulting from the operation to be applied to the camera and gizmos\r\n\t */\r\n\tscale( size, point, scaleGizmos = true ) {\r\n\r\n\t\t_scalePointTemp.copy( point );\r\n\t\tlet sizeInverse = 1 / size;\r\n\r\n\t\tif ( this.camera.isOrthographicCamera ) {\r\n\r\n\t\t\t//camera zoom\r\n\t\t\tthis.camera.zoom = this._zoomState;\r\n\t\t\tthis.camera.zoom *= size;\r\n\r\n\t\t\t//check min and max zoom\r\n\t\t\tif ( this.camera.zoom > this.maxZoom ) {\r\n\r\n\t\t\t\tthis.camera.zoom = this.maxZoom;\r\n\t\t\t\tsizeInverse = this._zoomState / this.maxZoom;\r\n\r\n\t\t\t} else if ( this.camera.zoom < this.minZoom ) {\r\n\r\n\t\t\t\tthis.camera.zoom = this.minZoom;\r\n\t\t\t\tsizeInverse = this._zoomState / this.minZoom;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tthis.camera.updateProjectionMatrix();\r\n\r\n\t\t\tthis._v3_1.setFromMatrixPosition( this._gizmoMatrixState );\t//gizmos position\r\n\r\n\t\t\t//scale gizmos so they appear in the same spot having the same dimension\r\n\t\t\tthis._scaleMatrix.makeScale( sizeInverse, sizeInverse, sizeInverse );\r\n\t\t\tthis._translationMatrix.makeTranslation( - this._v3_1.x, - this._v3_1.y, - this._v3_1.z );\r\n\r\n\t\t\tthis._m4_2.makeTranslation( this._v3_1.x, this._v3_1.y, this._v3_1.z ).multiply( this._scaleMatrix );\r\n\t\t\tthis._m4_2.multiply( this._translationMatrix );\r\n\r\n\r\n\t\t\t//move camera and gizmos to obtain pinch effect\r\n\t\t\t_scalePointTemp.sub( this._v3_1 );\r\n\r\n\t\t\tconst amount = _scalePointTemp.clone().multiplyScalar( sizeInverse );\r\n\t\t\t_scalePointTemp.sub( amount );\r\n\r\n\t\t\tthis._m4_1.makeTranslation( _scalePointTemp.x, _scalePointTemp.y, _scalePointTemp.z );\r\n\t\t\tthis._m4_2.premultiply( this._m4_1 );\r\n\r\n\t\t\tthis.setTransformationMatrices( this._m4_1, this._m4_2 );\r\n\t\t\treturn _transformation;\r\n\r\n\t\t} else if ( this.camera.isPerspectiveCamera ) {\r\n\r\n\t\t\tthis._v3_1.setFromMatrixPosition( this._cameraMatrixState );\r\n\t\t\tthis._v3_2.setFromMatrixPosition( this._gizmoMatrixState );\r\n\r\n\t\t\t//move camera\r\n\t\t\tlet distance = this._v3_1.distanceTo( _scalePointTemp );\r\n\t\t\tlet amount = distance - ( distance * sizeInverse );\r\n\r\n\t\t\t//check min and max distance\r\n\t\t\tconst newDistance = distance - amount;\r\n\t\t\tif ( newDistance < this.minDistance ) {\r\n\r\n\t\t\t\tsizeInverse = this.minDistance / distance;\r\n\t\t\t\tamount = distance - ( distance * sizeInverse );\r\n\r\n\t\t\t} else if ( newDistance > this.maxDistance ) {\r\n\r\n\t\t\t\tsizeInverse = this.maxDistance / distance;\r\n\t\t\t\tamount = distance - ( distance * sizeInverse );\r\n\r\n\t\t\t}\r\n\r\n\t\t\t_offset.copy( _scalePointTemp ).sub( this._v3_1 ).normalize().multiplyScalar( amount );\r\n\r\n\t\t\tthis._m4_1.makeTranslation( _offset.x, _offset.y, _offset.z );\r\n\r\n\r\n\t\t\tif ( scaleGizmos ) {\r\n\r\n\t\t\t\t//scale gizmos so they appear in the same spot having the same dimension\r\n\t\t\t\tconst pos = this._v3_2;\r\n\r\n\t\t\t\tdistance = pos.distanceTo( _scalePointTemp );\r\n\t\t\t\tamount = distance - ( distance * sizeInverse );\r\n\t\t\t\t_offset.copy( _scalePointTemp ).sub( this._v3_2 ).normalize().multiplyScalar( amount );\r\n\r\n\t\t\t\tthis._translationMatrix.makeTranslation( pos.x, pos.y, pos.z );\r\n\t\t\t\tthis._scaleMatrix.makeScale( sizeInverse, sizeInverse, sizeInverse );\r\n\r\n\t\t\t\tthis._m4_2.makeTranslation( _offset.x, _offset.y, _offset.z ).multiply( this._translationMatrix );\r\n\t\t\t\tthis._m4_2.multiply( this._scaleMatrix );\r\n\r\n\t\t\t\tthis._translationMatrix.makeTranslation( - pos.x, - pos.y, - pos.z );\r\n\r\n\t\t\t\tthis._m4_2.multiply( this._translationMatrix );\r\n\t\t\t\tthis.setTransformationMatrices( this._m4_1, this._m4_2 );\r\n\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tthis.setTransformationMatrices( this._m4_1 );\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn _transformation;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Set camera fov\r\n\t * @param {Number} value fov to be setted\r\n\t */\r\n\tsetFov( value ) {\r\n\r\n\t\tif ( this.camera.isPerspectiveCamera ) {\r\n\r\n\t\t\tthis.camera.fov = MathUtils.clamp( value, this.minFov, this.maxFov );\r\n\t\t\tthis.camera.updateProjectionMatrix();\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Set values in transformation object\r\n\t * @param {Matrix4} camera Transformation to be applied to the camera\r\n\t * @param {Matrix4} gizmos Transformation to be applied to gizmos\r\n\t */\r\n\t setTransformationMatrices( camera = null, gizmos = null ) {\r\n\r\n\t\tif ( camera != null ) {\r\n\r\n\t\t\tif ( _transformation.camera != null ) {\r\n\r\n\t\t\t\t_transformation.camera.copy( camera );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\t_transformation.camera = camera.clone();\r\n\r\n\t\t\t}\r\n\r\n\t\t} else {\r\n\r\n\t\t\t_transformation.camera = null;\r\n\r\n\t\t}\r\n\r\n\t\tif ( gizmos != null ) {\r\n\r\n\t\t\tif ( _transformation.gizmos != null ) {\r\n\r\n\t\t\t\t_transformation.gizmos.copy( gizmos );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\t_transformation.gizmos = gizmos.clone();\r\n\r\n\t\t\t}\r\n\r\n\t\t} else {\r\n\r\n\t\t\t_transformation.gizmos = null;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Rotate camera around its direction axis passing by a given point by a given angle\r\n\t * @param {Vector3} point The point where the rotation axis is passing trough\r\n\t * @param {Number} angle Angle in radians\r\n\t * @returns The computed transormation matix\r\n\t */\r\n\tzRotate( point, angle ) {\r\n\r\n\t\tthis._rotationMatrix.makeRotationAxis( this._rotationAxis, angle );\r\n\t\tthis._translationMatrix.makeTranslation( - point.x, - point.y, - point.z );\r\n\r\n\t\tthis._m4_1.makeTranslation( point.x, point.y, point.z );\r\n\t\tthis._m4_1.multiply( this._rotationMatrix );\r\n\t\tthis._m4_1.multiply( this._translationMatrix );\r\n\r\n\t\tthis._v3_1.setFromMatrixPosition( this._gizmoMatrixState ).sub( point );\t//vector from rotation center to gizmos position\r\n\t\tthis._v3_2.copy( this._v3_1 ).applyAxisAngle( this._rotationAxis, angle );\t//apply rotation\r\n\t\tthis._v3_2.sub( this._v3_1 );\r\n\r\n\t\tthis._m4_2.makeTranslation( this._v3_2.x, this._v3_2.y, this._v3_2.z );\r\n\r\n\t\tthis.setTransformationMatrices( this._m4_1, this._m4_2 );\r\n\t\treturn _transformation;\r\n\r\n\t}\r\n\r\n\r\n\tgetRaycaster() {\r\n\r\n\t\treturn _raycaster;\r\n\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * Unproject the cursor on the 3D object surface\r\n\t * @param {Vector2} cursor Cursor coordinates in NDC\r\n\t * @param {Camera} camera Virtual camera\r\n\t * @returns {Vector3} The point of intersection with the model, if exist, null otherwise\r\n\t */\r\n\tunprojectOnObj( cursor, camera ) {\r\n\r\n\t\tconst raycaster = this.getRaycaster();\r\n\t\traycaster.near = camera.near;\r\n\t\traycaster.far = camera.far;\r\n\t\traycaster.setFromCamera( cursor, camera );\r\n\r\n\t\tconst intersect = raycaster.intersectObjects( this.scene.children, true );\r\n\r\n\t\tfor ( let i = 0; i < intersect.length; i ++ ) {\r\n\r\n\t\t\tif ( intersect[ i ].object.uuid != this._gizmos.uuid && intersect[ i ].face != null ) {\r\n\r\n\t\t\t\treturn intersect[ i ].point.clone();\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\treturn null;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Unproject the cursor on the trackball surface\r\n\t * @param {Camera} camera The virtual camera\r\n\t * @param {Number} cursorX Cursor horizontal coordinate on screen\r\n\t * @param {Number} cursorY Cursor vertical coordinate on screen\r\n\t * @param {HTMLElement} canvas The canvas where the renderer draws its output\r\n\t * @param {number} tbRadius The trackball radius\r\n\t * @returns {Vector3} The unprojected point on the trackball surface\r\n\t */\r\n\tunprojectOnTbSurface( camera, cursorX, cursorY, canvas, tbRadius ) {\r\n\r\n\t\tif ( camera.type == 'OrthographicCamera' ) {\r\n\r\n\t\t\tthis._v2_1.copy( this.getCursorPosition( cursorX, cursorY, canvas ) );\r\n\t\t\tthis._v3_1.set( this._v2_1.x, this._v2_1.y, 0 );\r\n\r\n\t\t\tconst x2 = Math.pow( this._v2_1.x, 2 );\r\n\t\t\tconst y2 = Math.pow( this._v2_1.y, 2 );\r\n\t\t\tconst r2 = Math.pow( this._tbRadius, 2 );\r\n\r\n\t\t\tif ( x2 + y2 <= r2 * 0.5 ) {\r\n\r\n\t\t\t\t//intersection with sphere\r\n\t\t\t\tthis._v3_1.setZ( Math.sqrt( r2 - ( x2 + y2 ) ) );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\t//intersection with hyperboloid\r\n\t\t\t\tthis._v3_1.setZ( ( r2 * 0.5 ) / ( Math.sqrt( x2 + y2 ) ) );\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn this._v3_1;\r\n\r\n\t\t} else if ( camera.type == 'PerspectiveCamera' ) {\r\n\r\n\t\t\t//unproject cursor on the near plane\r\n\t\t\tthis._v2_1.copy( this.getCursorNDC( cursorX, cursorY, canvas ) );\r\n\r\n\t\t\tthis._v3_1.set( this._v2_1.x, this._v2_1.y, - 1 );\r\n\t\t\tthis._v3_1.applyMatrix4( camera.projectionMatrixInverse );\r\n\r\n\t\t\tconst rayDir = this._v3_1.clone().normalize(); //unprojected ray direction\r\n\t\t\tconst cameraGizmoDistance = camera.position.distanceTo( this._gizmos.position );\r\n\t\t\tconst radius2 = Math.pow( tbRadius, 2 );\r\n\r\n\t\t\t//\t  camera\r\n\t\t\t//\t\t|\\\r\n\t\t\t//\t\t| \\\r\n\t\t\t//\t\t|  \\\r\n\t\t\t//\th\t|\t\\\r\n\t\t\t//\t\t| \t \\\r\n\t\t\t//\t\t| \t  \\\r\n\t\t\t//\t_ _ | _ _ _\\ _ _  near plane\r\n\t\t\t//\t\t\tl\r\n\r\n\t\t\tconst h = this._v3_1.z;\r\n\t\t\tconst l = Math.sqrt( Math.pow( this._v3_1.x, 2 ) + Math.pow( this._v3_1.y, 2 ) );\r\n\r\n\t\t\tif ( l == 0 ) {\r\n\r\n\t\t\t\t//ray aligned with camera\r\n\t\t\t\trayDir.set( this._v3_1.x, this._v3_1.y, tbRadius );\r\n\t\t\t\treturn rayDir;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tconst m = h / l;\r\n\t\t\tconst q = cameraGizmoDistance;\r\n\r\n\t\t\t/*\r\n\t\t\t * calculate intersection point between unprojected ray and trackball surface\r\n\t\t\t *|y = m * x + q\r\n\t\t\t *|x^2 + y^2 = r^2\r\n\t\t\t *\r\n\t\t\t * (m^2 + 1) * x^2 + (2 * m * q) * x + q^2 - r^2 = 0\r\n\t\t\t */\r\n\t\t\tlet a = Math.pow( m, 2 ) + 1;\r\n\t\t\tlet b = 2 * m * q;\r\n\t\t\tlet c = Math.pow( q, 2 ) - radius2;\r\n\t\t\tlet delta = Math.pow( b, 2 ) - ( 4 * a * c );\r\n\r\n\t\t\tif ( delta >= 0 ) {\r\n\r\n\t\t\t\t//intersection with sphere\r\n\t\t\t\tthis._v2_1.setX( ( - b - Math.sqrt( delta ) ) / ( 2 * a ) );\r\n\t\t\t\tthis._v2_1.setY( m * this._v2_1.x + q );\r\n\r\n\t\t\t\tconst angle = MathUtils.RAD2DEG * this._v2_1.angle();\r\n\r\n\t\t\t\tif ( angle >= 45 ) {\r\n\r\n\t\t\t\t\t//if angle between intersection point and X' axis is >= 45°, return that point\r\n\t\t\t\t\t//otherwise, calculate intersection point with hyperboloid\r\n\r\n\t\t\t\t\tconst rayLength = Math.sqrt( Math.pow( this._v2_1.x, 2 ) + Math.pow( ( cameraGizmoDistance - this._v2_1.y ), 2 ) );\r\n\t\t\t\t\trayDir.multiplyScalar( rayLength );\r\n\t\t\t\t\trayDir.z += cameraGizmoDistance;\r\n\t\t\t\t\treturn rayDir;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\t//intersection with hyperboloid\r\n\t\t\t/*\r\n\t\t\t *|y = m * x + q\r\n\t\t\t *|y = (1 / x) * (r^2 / 2)\r\n\t\t\t *\r\n\t\t\t * m * x^2 + q * x - r^2 / 2 = 0\r\n\t\t\t */\r\n\r\n\t\t\ta = m;\r\n\t\t\tb = q;\r\n\t\t\tc = - radius2 * 0.5;\r\n\t\t\tdelta = Math.pow( b, 2 ) - ( 4 * a * c );\r\n\t\t\tthis._v2_1.setX( ( - b - Math.sqrt( delta ) ) / ( 2 * a ) );\r\n\t\t\tthis._v2_1.setY( m * this._v2_1.x + q );\r\n\r\n\t\t\tconst rayLength = Math.sqrt( Math.pow( this._v2_1.x, 2 ) + Math.pow( ( cameraGizmoDistance - this._v2_1.y ), 2 ) );\r\n\r\n\t\t\trayDir.multiplyScalar( rayLength );\r\n\t\t\trayDir.z += cameraGizmoDistance;\r\n\t\t\treturn rayDir;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * Unproject the cursor on the plane passing through the center of the trackball orthogonal to the camera\r\n\t * @param {Camera} camera The virtual camera\r\n\t * @param {Number} cursorX Cursor horizontal coordinate on screen\r\n\t * @param {Number} cursorY Cursor vertical coordinate on screen\r\n\t * @param {HTMLElement} canvas The canvas where the renderer draws its output\r\n\t * @param {Boolean} initialDistance If initial distance between camera and gizmos should be used for calculations instead of current (Perspective only)\r\n\t * @returns {Vector3} The unprojected point on the trackball plane\r\n\t */\r\n\tunprojectOnTbPlane( camera, cursorX, cursorY, canvas, initialDistance = false ) {\r\n\r\n\t\tif ( camera.type == 'OrthographicCamera' ) {\r\n\r\n\t\t\tthis._v2_1.copy( this.getCursorPosition( cursorX, cursorY, canvas ) );\r\n\t\t\tthis._v3_1.set( this._v2_1.x, this._v2_1.y, 0 );\r\n\r\n\t\t\treturn this._v3_1.clone();\r\n\r\n\t\t} else if ( camera.type == 'PerspectiveCamera' ) {\r\n\r\n\t\t\tthis._v2_1.copy( this.getCursorNDC( cursorX, cursorY, canvas ) );\r\n\r\n\t\t\t//unproject cursor on the near plane\r\n\t\t\tthis._v3_1.set( this._v2_1.x, this._v2_1.y, - 1 );\r\n\t\t\tthis._v3_1.applyMatrix4( camera.projectionMatrixInverse );\r\n\r\n\t\t\tconst rayDir = this._v3_1.clone().normalize(); //unprojected ray direction\r\n\r\n\t\t\t//\t  camera\r\n\t\t\t//\t\t|\\\r\n\t\t\t//\t\t| \\\r\n\t\t\t//\t\t|  \\\r\n\t\t\t//\th\t|\t\\\r\n\t\t\t//\t\t| \t \\\r\n\t\t\t//\t\t| \t  \\\r\n\t\t\t//\t_ _ | _ _ _\\ _ _  near plane\r\n\t\t\t//\t\t\tl\r\n\r\n\t\t\tconst h = this._v3_1.z;\r\n\t\t\tconst l = Math.sqrt( Math.pow( this._v3_1.x, 2 ) + Math.pow( this._v3_1.y, 2 ) );\r\n\t\t\tlet cameraGizmoDistance;\r\n\r\n\t\t\tif ( initialDistance ) {\r\n\r\n\t\t\t\tcameraGizmoDistance = this._v3_1.setFromMatrixPosition( this._cameraMatrixState0 ).distanceTo( this._v3_2.setFromMatrixPosition( this._gizmoMatrixState0 ) );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tcameraGizmoDistance = camera.position.distanceTo( this._gizmos.position );\r\n\r\n\t\t\t}\r\n\r\n\t\t\t/*\r\n\t\t\t * calculate intersection point between unprojected ray and the plane\r\n\t\t\t *|y = mx + q\r\n\t\t\t *|y = 0\r\n\t\t\t *\r\n\t\t\t * x = -q/m\r\n\t\t\t*/\r\n\t\t\tif ( l == 0 ) {\r\n\r\n\t\t\t\t//ray aligned with camera\r\n\t\t\t\trayDir.set( 0, 0, 0 );\r\n\t\t\t\treturn rayDir;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tconst m = h / l;\r\n\t\t\tconst q = cameraGizmoDistance;\r\n\t\t\tconst x = - q / m;\r\n\r\n\t\t\tconst rayLength = Math.sqrt( Math.pow( q, 2 ) + Math.pow( x, 2 ) );\r\n\t\t\trayDir.multiplyScalar( rayLength );\r\n\t\t\trayDir.z = 0;\r\n\t\t\treturn rayDir;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Update camera and gizmos state\r\n\t */\r\n\tupdateMatrixState() {\r\n\r\n\t\t//update camera and gizmos state\r\n\t\tthis._cameraMatrixState.copy( this.camera.matrix );\r\n\t\tthis._gizmoMatrixState.copy( this._gizmos.matrix );\r\n\r\n\t\tif ( this.camera.isOrthographicCamera ) {\r\n\r\n\t\t\tthis._cameraProjectionState.copy( this.camera.projectionMatrix );\r\n\t\t\tthis.camera.updateProjectionMatrix();\r\n\t\t\tthis._zoomState = this.camera.zoom;\r\n\r\n\t\t} else if ( this.camera.isPerspectiveCamera ) {\r\n\r\n\t\t\tthis._fovState = this.camera.fov;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Update the trackball FSA\r\n\t * @param {STATE} newState New state of the FSA\r\n\t * @param {Boolean} updateMatrices If matriices state should be updated\r\n\t */\r\n\tupdateTbState( newState, updateMatrices ) {\r\n\r\n\t\tthis._state = newState;\r\n\t\tif ( updateMatrices ) {\r\n\r\n\t\t\tthis.updateMatrixState();\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tupdate() {\r\n\r\n\t\tconst EPS = 0.000001;\r\n\r\n\t\tif ( this.target.equals( this._currentTarget ) === false ) {\r\n\r\n\t\t\tthis._gizmos.position.copy( this.target );\t//for correct radius calculation\r\n\t\t\tthis._tbRadius = this.calculateTbRadius( this.camera );\r\n\t\t\tthis.makeGizmos( this.target, this._tbRadius );\r\n\t\t\tthis._currentTarget.copy( this.target );\r\n\r\n\t\t}\r\n\r\n\t\t//check min/max parameters\r\n\t\tif ( this.camera.isOrthographicCamera ) {\r\n\r\n\t\t\t//check zoom\r\n\t\t\tif ( this.camera.zoom > this.maxZoom || this.camera.zoom < this.minZoom ) {\r\n\r\n\t\t\t\tconst newZoom = MathUtils.clamp( this.camera.zoom, this.minZoom, this.maxZoom );\r\n\t\t\t\tthis.applyTransformMatrix( this.scale( newZoom / this.camera.zoom, this._gizmos.position, true ) );\r\n\r\n\t\t\t}\r\n\r\n\t\t} else if ( this.camera.isPerspectiveCamera ) {\r\n\r\n\t\t\t//check distance\r\n\t\t\tconst distance = this.camera.position.distanceTo( this._gizmos.position );\r\n\r\n\t\t\tif ( distance > this.maxDistance + EPS || distance < this.minDistance - EPS ) {\r\n\r\n\t\t\t\tconst newDistance = MathUtils.clamp( distance, this.minDistance, this.maxDistance );\r\n\t\t\t\tthis.applyTransformMatrix( this.scale( newDistance / distance, this._gizmos.position ) );\r\n\t\t\t\tthis.updateMatrixState();\r\n\r\n\t\t\t }\r\n\r\n\t\t\t//check fov\r\n\t\t\tif ( this.camera.fov < this.minFov || this.camera.fov > this.maxFov ) {\r\n\r\n\t\t\t\tthis.camera.fov = MathUtils.clamp( this.camera.fov, this.minFov, this.maxFov );\r\n\t\t\t\tthis.camera.updateProjectionMatrix();\r\n\r\n\t\t\t}\r\n\r\n\t\t\tconst oldRadius = this._tbRadius;\r\n\t\t\tthis._tbRadius = this.calculateTbRadius( this.camera );\r\n\r\n\t\t\tif ( oldRadius < this._tbRadius - EPS || oldRadius > this._tbRadius + EPS ) {\r\n\r\n\t\t\t\tconst scale = ( this._gizmos.scale.x + this._gizmos.scale.y + this._gizmos.scale.z ) / 3;\r\n\t\t\t\tconst newRadius = this._tbRadius / scale;\r\n\t\t\t\tconst curve = new EllipseCurve( 0, 0, newRadius, newRadius );\r\n\t\t\t\tconst points = curve.getPoints( this._curvePts );\r\n\t\t\t\tconst curveGeometry = new BufferGeometry().setFromPoints( points );\r\n\r\n\t\t\t\tfor ( const gizmo in this._gizmos.children ) {\r\n\r\n\t\t\t\t\tthis._gizmos.children[ gizmo ].geometry = curveGeometry;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tthis.camera.lookAt( this._gizmos.position );\r\n\r\n\t}\r\n\r\n\tsetStateFromJSON( json ) {\r\n\r\n\t\tconst state = JSON.parse( json );\r\n\r\n\t\tif ( state.arcballState != undefined ) {\r\n\r\n\t\t\tthis._cameraMatrixState.fromArray( state.arcballState.cameraMatrix.elements );\r\n\t\t\tthis._cameraMatrixState.decompose( this.camera.position, this.camera.quaternion, this.camera.scale );\r\n\r\n\t\t\tthis.camera.up.copy( state.arcballState.cameraUp );\r\n\t\t\tthis.camera.near = state.arcballState.cameraNear;\r\n\t\t\tthis.camera.far = state.arcballState.cameraFar;\r\n\r\n\t\t\tthis.camera.zoom = state.arcballState.cameraZoom;\r\n\r\n\t\t\tif ( this.camera.isPerspectiveCamera ) {\r\n\r\n\t\t\t\tthis.camera.fov = state.arcballState.cameraFov;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tthis._gizmoMatrixState.fromArray( state.arcballState.gizmoMatrix.elements );\r\n\t\t\tthis._gizmoMatrixState.decompose( this._gizmos.position, this._gizmos.quaternion, this._gizmos.scale );\r\n\r\n\t\t\tthis.camera.updateMatrix();\r\n\t\t\tthis.camera.updateProjectionMatrix();\r\n\r\n\t\t\tthis._gizmos.updateMatrix();\r\n\r\n\t\t\tthis._tbRadius = this.calculateTbRadius( this.camera );\r\n\t\t\tconst gizmoTmp = new Matrix4().copy( this._gizmoMatrixState0 );\r\n\t\t\tthis.makeGizmos( this._gizmos.position, this._tbRadius );\r\n\t\t\tthis._gizmoMatrixState0.copy( gizmoTmp );\r\n\r\n\t\t\tthis.camera.lookAt( this._gizmos.position );\r\n\t\t\tthis.updateTbState( STATE.IDLE, false );\r\n\r\n\t\t\tthis.dispatchEvent( _changeEvent );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n}\r\n\r\n//listeners\r\n\r\nfunction onWindowResize() {\r\n\r\n\tconst scale = ( this._gizmos.scale.x + this._gizmos.scale.y + this._gizmos.scale.z ) / 3;\r\n\tthis._tbRadius = this.calculateTbRadius( this.camera );\r\n\r\n\tconst newRadius = this._tbRadius / scale;\r\n\tconst curve = new EllipseCurve( 0, 0, newRadius, newRadius );\r\n\tconst points = curve.getPoints( this._curvePts );\r\n\tconst curveGeometry = new BufferGeometry().setFromPoints( points );\r\n\r\n\r\n\tfor ( const gizmo in this._gizmos.children ) {\r\n\r\n\t\tthis._gizmos.children[ gizmo ].geometry = curveGeometry;\r\n\r\n\t}\r\n\r\n\tthis.dispatchEvent( _changeEvent );\r\n\r\n}\r\n\r\nfunction onContextMenu( event ) {\r\n\r\n\tif ( ! this.enabled ) {\r\n\r\n\t\treturn;\r\n\r\n\t}\r\n\r\n\tfor ( let i = 0; i < this.mouseActions.length; i ++ ) {\r\n\r\n\t\tif ( this.mouseActions[ i ].mouse == 2 ) {\r\n\r\n\t\t\t//prevent only if button 2 is actually used\r\n\t\t\tevent.preventDefault();\r\n\t\t\tbreak;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n}\r\n\r\nfunction onPointerCancel() {\r\n\r\n\tthis._touchStart.splice( 0, this._touchStart.length );\r\n\tthis._touchCurrent.splice( 0, this._touchCurrent.length );\r\n\tthis._input = INPUT.NONE;\r\n\r\n}\r\n\r\nfunction onPointerDown( event ) {\r\n\r\n\tif ( event.button == 0 && event.isPrimary ) {\r\n\r\n\t\tthis._downValid = true;\r\n\t\tthis._downEvents.push( event );\r\n\t\tthis._downStart = performance.now();\r\n\r\n\t} else {\r\n\r\n\t\tthis._downValid = false;\r\n\r\n\t}\r\n\r\n\tif ( event.pointerType == 'touch' && this._input != INPUT.CURSOR ) {\r\n\r\n\t\tthis._touchStart.push( event );\r\n\t\tthis._touchCurrent.push( event );\r\n\r\n\t\tswitch ( this._input ) {\r\n\r\n\t\t\tcase INPUT.NONE:\r\n\r\n\t\t\t\t//singleStart\r\n\t\t\t\tthis._input = INPUT.ONE_FINGER;\r\n\t\t\t\tthis.onSinglePanStart( event, 'ROTATE' );\r\n\r\n\t\t\t\twindow.addEventListener( 'pointermove', this._onPointerMove );\r\n\t\t\t\twindow.addEventListener( 'pointerup', this._onPointerUp );\r\n\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase INPUT.ONE_FINGER:\r\n\t\t\tcase INPUT.ONE_FINGER_SWITCHED:\r\n\r\n\t\t\t\t//doubleStart\r\n\t\t\t\tthis._input = INPUT.TWO_FINGER;\r\n\r\n\t\t\t\tthis.onRotateStart();\r\n\t\t\t\tthis.onPinchStart();\r\n\t\t\t\tthis.onDoublePanStart();\r\n\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase INPUT.TWO_FINGER:\r\n\r\n\t\t\t\t//multipleStart\r\n\t\t\t\tthis._input = INPUT.MULT_FINGER;\r\n\t\t\t\tthis.onTriplePanStart( event );\r\n\t\t\t\tbreak;\r\n\r\n\t\t}\r\n\r\n\t} else if ( event.pointerType != 'touch' && this._input == INPUT.NONE ) {\r\n\r\n\t\tlet modifier = null;\r\n\r\n\t\tif ( event.ctrlKey || event.metaKey ) {\r\n\r\n\t\t\tmodifier = 'CTRL';\r\n\r\n\t\t} else if ( event.shiftKey ) {\r\n\r\n\t\t\tmodifier = 'SHIFT';\r\n\r\n\t\t}\r\n\r\n\t\tthis._mouseOp = this.getOpFromAction( event.button, modifier );\r\n\t\tif ( this._mouseOp != null ) {\r\n\r\n\t\t\twindow.addEventListener( 'pointermove', this._onPointerMove );\r\n\t\t\twindow.addEventListener( 'pointerup', this._onPointerUp );\r\n\r\n\t\t\t//singleStart\r\n\t\t\tthis._input = INPUT.CURSOR;\r\n\t\t\tthis._button = event.button;\r\n\t\t\tthis.onSinglePanStart( event, this._mouseOp );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n}\r\n\r\nfunction onPointerMove( event ) {\r\n\r\n\tif ( event.pointerType == 'touch' && this._input != INPUT.CURSOR ) {\r\n\r\n\t\tswitch ( this._input ) {\r\n\r\n\t\t\tcase INPUT.ONE_FINGER:\r\n\r\n\t\t\t\t//singleMove\r\n\t\t\t\tthis.updateTouchEvent( event );\r\n\r\n\t\t\t\tthis.onSinglePanMove( event, STATE.ROTATE );\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase INPUT.ONE_FINGER_SWITCHED:\r\n\r\n\t\t\t\tconst movement = this.calculatePointersDistance( this._touchCurrent[ 0 ], event ) * this._devPxRatio;\r\n\r\n\t\t\t\tif ( movement >= this._switchSensibility ) {\r\n\r\n\t\t\t\t\t//singleMove\r\n\t\t\t\t\tthis._input = INPUT.ONE_FINGER;\r\n\t\t\t\t\tthis.updateTouchEvent( event );\r\n\r\n\t\t\t\t\tthis.onSinglePanStart( event, 'ROTATE' );\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase INPUT.TWO_FINGER:\r\n\r\n\t\t\t\t//rotate/pan/pinchMove\r\n\t\t\t\tthis.updateTouchEvent( event );\r\n\r\n\t\t\t\tthis.onRotateMove();\r\n\t\t\t\tthis.onPinchMove();\r\n\t\t\t\tthis.onDoublePanMove();\r\n\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase INPUT.MULT_FINGER:\r\n\r\n\t\t\t\t//multMove\r\n\t\t\t\tthis.updateTouchEvent( event );\r\n\r\n\t\t\t\tthis.onTriplePanMove( event );\r\n\t\t\t\tbreak;\r\n\r\n\t\t}\r\n\r\n\t} else if ( event.pointerType != 'touch' && this._input == INPUT.CURSOR ) {\r\n\r\n\t\tlet modifier = null;\r\n\r\n\t\tif ( event.ctrlKey || event.metaKey ) {\r\n\r\n\t\t\tmodifier = 'CTRL';\r\n\r\n\t\t} else if ( event.shiftKey ) {\r\n\r\n\t\t\tmodifier = 'SHIFT';\r\n\r\n\t\t}\r\n\r\n\t\tconst mouseOpState = this.getOpStateFromAction( this._button, modifier );\r\n\r\n\t\tif ( mouseOpState != null ) {\r\n\r\n\t\t\tthis.onSinglePanMove( event, mouseOpState );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t//checkDistance\r\n\tif ( this._downValid ) {\r\n\r\n\t\tconst movement = this.calculatePointersDistance( this._downEvents[ this._downEvents.length - 1 ], event ) * this._devPxRatio;\r\n\t\tif ( movement > this._movementThreshold ) {\r\n\r\n\t\t\tthis._downValid = false;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n}\r\n\r\nfunction onPointerUp( event ) {\r\n\r\n\tif ( event.pointerType == 'touch' && this._input != INPUT.CURSOR ) {\r\n\r\n\t\tconst nTouch = this._touchCurrent.length;\r\n\r\n\t\tfor ( let i = 0; i < nTouch; i ++ ) {\r\n\r\n\t\t\tif ( this._touchCurrent[ i ].pointerId == event.pointerId ) {\r\n\r\n\t\t\t\tthis._touchCurrent.splice( i, 1 );\r\n\t\t\t\tthis._touchStart.splice( i, 1 );\r\n\t\t\t\tbreak;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tswitch ( this._input ) {\r\n\r\n\t\t\tcase INPUT.ONE_FINGER:\r\n\t\t\tcase INPUT.ONE_FINGER_SWITCHED:\r\n\r\n\t\t\t\t//singleEnd\r\n\t\t\t\twindow.removeEventListener( 'pointermove', this._onPointerMove );\r\n\t\t\t\twindow.removeEventListener( 'pointerup', this._onPointerUp );\r\n\r\n\t\t\t\tthis._input = INPUT.NONE;\r\n\t\t\t\tthis.onSinglePanEnd();\r\n\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase INPUT.TWO_FINGER:\r\n\r\n\t\t\t\t//doubleEnd\r\n\t\t\t\tthis.onDoublePanEnd( event );\r\n\t\t\t\tthis.onPinchEnd( event );\r\n\t\t\t\tthis.onRotateEnd( event );\r\n\r\n\t\t\t\t//switching to singleStart\r\n\t\t\t\tthis._input = INPUT.ONE_FINGER_SWITCHED;\r\n\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase INPUT.MULT_FINGER:\r\n\r\n\t\t\t\tif ( this._touchCurrent.length == 0 ) {\r\n\r\n\t\t\t\t\twindow.removeEventListener( 'pointermove', this._onPointerMove );\r\n\t\t\t\t\twindow.removeEventListener( 'pointerup', this._onPointerUp );\r\n\r\n\t\t\t\t\t//multCancel\r\n\t\t\t\t\tthis._input = INPUT.NONE;\r\n\t\t\t\t\tthis.onTriplePanEnd();\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tbreak;\r\n\r\n\t\t}\r\n\r\n\t} else if ( event.pointerType != 'touch' && this._input == INPUT.CURSOR ) {\r\n\r\n\t\twindow.removeEventListener( 'pointermove', this._onPointerMove );\r\n\t\twindow.removeEventListener( 'pointerup', this._onPointerUp );\r\n\r\n\t\tthis._input = INPUT.NONE;\r\n\t\tthis.onSinglePanEnd();\r\n\t\tthis._button = - 1;\r\n\r\n\t}\r\n\r\n\tif ( event.isPrimary ) {\r\n\r\n\t\tif ( this._downValid ) {\r\n\r\n\t\t\tconst downTime = event.timeStamp - this._downEvents[ this._downEvents.length - 1 ].timeStamp;\r\n\r\n\t\t\tif ( downTime <= this._maxDownTime ) {\r\n\r\n\t\t\t\tif ( this._nclicks == 0 ) {\r\n\r\n\t\t\t\t\t//first valid click detected\r\n\t\t\t\t\tthis._nclicks = 1;\r\n\t\t\t\t\tthis._clickStart = performance.now();\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tconst clickInterval = event.timeStamp - this._clickStart;\r\n\t\t\t\t\tconst movement = this.calculatePointersDistance( this._downEvents[ 1 ], this._downEvents[ 0 ] ) * this._devPxRatio;\r\n\r\n\t\t\t\t\tif ( clickInterval <= this._maxInterval && movement <= this._posThreshold ) {\r\n\r\n\t\t\t\t\t\t//second valid click detected\r\n\t\t\t\t\t\t//fire double tap and reset values\r\n\t\t\t\t\t\tthis._nclicks = 0;\r\n\t\t\t\t\t\tthis._downEvents.splice( 0, this._downEvents.length );\r\n\t\t\t\t\t\tthis.onDoubleTap( event );\r\n\r\n\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\t//new 'first click'\r\n\t\t\t\t\t\tthis._nclicks = 1;\r\n\t\t\t\t\t\tthis._downEvents.shift();\r\n\t\t\t\t\t\tthis._clickStart = performance.now();\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tthis._downValid = false;\r\n\t\t\t\tthis._nclicks = 0;\r\n\t\t\t\tthis._downEvents.splice( 0, this._downEvents.length );\r\n\r\n\t\t\t}\r\n\r\n\t\t} else {\r\n\r\n\t\t\tthis._nclicks = 0;\r\n\t\t\tthis._downEvents.splice( 0, this._downEvents.length );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n}\r\n\r\nfunction onWheel( event ) {\r\n\r\n\tif ( this.enabled && this.enableZoom ) {\r\n\r\n\t\tlet modifier = null;\r\n\r\n\t\tif ( event.ctrlKey || event.metaKey ) {\r\n\r\n\t\t\tmodifier = 'CTRL';\r\n\r\n\t\t} else if ( event.shiftKey ) {\r\n\r\n\t\t\tmodifier = 'SHIFT';\r\n\r\n\t\t}\r\n\r\n\t\tconst mouseOp = this.getOpFromAction( 'WHEEL', modifier );\r\n\r\n\t\tif ( mouseOp != null ) {\r\n\r\n\t\t\tevent.preventDefault();\r\n\t\t\tthis.dispatchEvent( _startEvent );\r\n\r\n\t\t\tconst notchDeltaY = 125; //distance of one notch of mouse wheel\r\n\t\t\tlet sgn = event.deltaY / notchDeltaY;\r\n\r\n\t\t\tlet size = 1;\r\n\r\n\t\t\tif ( sgn > 0 ) {\r\n\r\n\t\t\t\tsize = 1 / this.scaleFactor;\r\n\r\n\t\t\t} else if ( sgn < 0 ) {\r\n\r\n\t\t\t\tsize = this.scaleFactor;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tswitch ( mouseOp ) {\r\n\r\n\t\t\t\tcase 'ZOOM':\r\n\r\n\t\t\t\t\tthis.updateTbState( STATE.SCALE, true );\r\n\r\n\t\t\t\t\tif ( sgn > 0 ) {\r\n\r\n\t\t\t\t\t\tsize = 1 / ( Math.pow( this.scaleFactor, sgn ) );\r\n\r\n\t\t\t\t\t} else if ( sgn < 0 ) {\r\n\r\n\t\t\t\t\t\tsize = Math.pow( this.scaleFactor, - sgn );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif ( this.cursorZoom && this.enablePan ) {\r\n\r\n\t\t\t\t\t\tlet scalePoint;\r\n\r\n\t\t\t\t\t\tif ( this.camera.isOrthographicCamera ) {\r\n\r\n\t\t\t\t\t\t\tscalePoint = this.unprojectOnTbPlane( this.camera, event.clientX, event.clientY, this.domElement ).applyQuaternion( this.camera.quaternion ).multiplyScalar( 1 / this.camera.zoom ).add( this._gizmos.position );\r\n\r\n\t\t\t\t\t\t} else if ( this.camera.isPerspectiveCamera ) {\r\n\r\n\t\t\t\t\t\t\tscalePoint = this.unprojectOnTbPlane( this.camera, event.clientX, event.clientY, this.domElement ).applyQuaternion( this.camera.quaternion ).add( this._gizmos.position );\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tthis.applyTransformMatrix( this.scale( size, scalePoint ) );\r\n\r\n\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\tthis.applyTransformMatrix( this.scale( size, this._gizmos.position ) );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif ( this._grid != null ) {\r\n\r\n\t\t\t\t\t\tthis.disposeGrid();\r\n\t\t\t\t\t\tthis.drawGrid();\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tthis.updateTbState( STATE.IDLE, false );\r\n\r\n\t\t\t\t\tthis.dispatchEvent( _changeEvent );\r\n\t\t\t\t\tthis.dispatchEvent( _endEvent );\r\n\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'FOV':\r\n\r\n\t\t\t\t\tif ( this.camera.isPerspectiveCamera ) {\r\n\r\n\t\t\t\t\t\tthis.updateTbState( STATE.FOV, true );\r\n\r\n\r\n\t\t\t\t\t\t//Vertigo effect\r\n\r\n\t\t\t\t\t\t//\t  fov / 2\r\n\t\t\t\t\t\t//\t\t|\\\r\n\t\t\t\t\t\t//\t\t| \\\r\n\t\t\t\t\t\t//\t\t|  \\\r\n\t\t\t\t\t\t//\tx\t|\t\\\r\n\t\t\t\t\t\t//\t\t| \t \\\r\n\t\t\t\t\t\t//\t\t| \t  \\\r\n\t\t\t\t\t\t//\t\t| _ _ _\\\r\n\t\t\t\t\t\t//\t\t\ty\r\n\r\n\t\t\t\t\t\t//check for iOs shift shortcut\r\n\t\t\t\t\t\tif ( event.deltaX != 0 ) {\r\n\r\n\t\t\t\t\t\t\tsgn = event.deltaX / notchDeltaY;\r\n\r\n\t\t\t\t\t\t\tsize = 1;\r\n\r\n\t\t\t\t\t\t\tif ( sgn > 0 ) {\r\n\r\n\t\t\t\t\t\t\t\tsize = 1 / ( Math.pow( this.scaleFactor, sgn ) );\r\n\r\n\t\t\t\t\t\t\t} else if ( sgn < 0 ) {\r\n\r\n\t\t\t\t\t\t\t\tsize = Math.pow( this.scaleFactor, - sgn );\r\n\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tthis._v3_1.setFromMatrixPosition( this._cameraMatrixState );\r\n\t\t\t\t\t\tconst x = this._v3_1.distanceTo( this._gizmos.position );\r\n\t\t\t\t\t\tlet xNew = x / size;\t//distance between camera and gizmos if scale(size, scalepoint) would be performed\r\n\r\n\t\t\t\t\t\t//check min and max distance\r\n\t\t\t\t\t\txNew = MathUtils.clamp( xNew, this.minDistance, this.maxDistance );\r\n\r\n\t\t\t\t\t\tconst y = x * Math.tan( MathUtils.DEG2RAD * this.camera.fov * 0.5 );\r\n\r\n\t\t\t\t\t\t//calculate new fov\r\n\t\t\t\t\t\tlet newFov = MathUtils.RAD2DEG * ( Math.atan( y / xNew ) * 2 );\r\n\r\n\t\t\t\t\t\t//check min and max fov\r\n\t\t\t\t\t\tif ( newFov > this.maxFov ) {\r\n\r\n\t\t\t\t\t\t\tnewFov = this.maxFov;\r\n\r\n\t\t\t\t\t\t} else if ( newFov < this.minFov ) {\r\n\r\n\t\t\t\t\t\t\tnewFov = this.minFov;\r\n\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tconst newDistance = y / Math.tan( MathUtils.DEG2RAD * ( newFov / 2 ) );\r\n\t\t\t\t\t\tsize = x / newDistance;\r\n\r\n\t\t\t\t\t\tthis.setFov( newFov );\r\n\t\t\t\t\t\tthis.applyTransformMatrix( this.scale( size, this._gizmos.position, false ) );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif ( this._grid != null ) {\r\n\r\n\t\t\t\t\t\tthis.disposeGrid();\r\n\t\t\t\t\t\tthis.drawGrid();\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tthis.updateTbState( STATE.IDLE, false );\r\n\r\n\t\t\t\t\tthis.dispatchEvent( _changeEvent );\r\n\t\t\t\t\tthis.dispatchEvent( _endEvent );\r\n\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n}\r\n\r\nexport { ArcballControls };\r\n"],
  "mappings": "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",
  "names": ["rayLength"]
}
